(this.webpackJsonpbobba_client=this.webpackJsonpbobba_client||[]).push([[0],{28:function(e,t,n){e.exports=n(68)},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a,i=n(0),r=n.n(i),o=n(11),s=n(1),l=n(2),c=n(4),u=n(3),h=n(5),d=n(6),m=function(){function e(t,n,a,i,r,o,l){var c=this;Object(s.a)(this,e),this.pixiApp=void 0,this.logicPixiApp=void 0,this.onResizeHandler=void 0,this.onMouseMoveHandler=void 0,this.onTouchStartHandler=void 0,this.onTouchMoveHandler=void 0,this.onMouseClickHandler=void 0,this.onMouseDoubleClickHandler=void 0,this.isMouseDragging=void 0,this.globalTextures=void 0,this.onResize=function(){c.pixiApp.renderer.resize(e.getViewportWidth(),e.getViewportHeight()),c.logicPixiApp.renderer.resize(e.getViewportWidth(),e.getViewportHeight()),c.onResizeHandler()},this.setMouseInteractions=function(){c.pixiApp.view.addEventListener("mousemove",(function(e){c.onMouseMoveHandler(e.x,e.y,c.isMouseDragging)}),!1),c.pixiApp.view.addEventListener("click",(function(e){c.onMouseClickHandler(e.x,e.y,e.shiftKey,e.ctrlKey,e.altKey)}),!1),c.pixiApp.view.addEventListener("dblclick",(function(e){c.onMouseDoubleClickHandler(e.x,e.y)}),!1),c.pixiApp.view.addEventListener("touchstart",(function(e){e.preventDefault(),1===e.touches.length&&c.onTouchStartHandler(e.touches[0].clientX,e.touches[0].clientY)}),!1),c.pixiApp.view.addEventListener("touchmove",(function(e){e.preventDefault(),1===e.touches.length&&c.onTouchMoveHandler(e.touches[0].clientX,e.touches[0].clientY)}),!1),c.pixiApp.view.addEventListener("mousedown",(function(e){c.isMouseDragging=!0}),!1),c.pixiApp.view.addEventListener("mouseup",(function(e){c.isMouseDragging=!1}),!1)},this.isMouseDragging=!1,this.onResizeHandler=n,this.onMouseMoveHandler=a,this.onTouchMoveHandler=r,this.onTouchStartHandler=i,this.onMouseClickHandler=o,this.onMouseDoubleClickHandler=l,this.globalTextures={};var u=new d.a({width:window.innerWidth,height:window.innerHeight,antialias:!1,transparent:!1,resolution:1}),h=new d.a({width:window.innerWidth,height:window.innerHeight,antialias:!1,transparent:!1,resolution:1});h.renderer.autoResize=!0,u.renderer.autoResize=!0,h.ticker.add((function(e){return t(e)})),h.ticker.minFPS=0,this.pixiApp=h,this.logicPixiApp=u,window.addEventListener("resize",this.onResize,!1),this.setMouseInteractions()}return Object(l.a)(e,[{key:"loadGlobalTextures",value:function(e){var t=this;return new Promise((function(n,a){var i=d.e.shared;i.add(e),i.load((function(e,n){for(var a in n){var i=n[a];void 0!==i&&(t.globalTextures[a]=i.texture)}})),i.onError.add((function(){return a("Cannot load global textures")})),i.onComplete.add((function(){return n()}))}))}},{key:"onEnterRoom",value:function(){document.body.appendChild(this.pixiApp.view)}},{key:"onLeaveRoom",value:function(){document.body.removeChild(this.pixiApp.view)}},{key:"getTextureFromImage",value:function(e){var t=new d.c(e);return new d.h(t)}},{key:"getTexture",value:function(e){return this.globalTextures[e]}},{key:"getMainStage",value:function(){return this.pixiApp.stage}},{key:"getLogicStage",value:function(){return this.logicPixiApp.stage}}],[{key:"getViewportWidth",value:function(){return window.innerWidth}},{key:"getViewportHeight",value:function(){return window.innerHeight}}]),e}(),g="assets/furni_placeholder.png",v=-34,f=-49,p="assets/wall_placeholder.png",b=-18,y=-25,I="assets/shadow_tile.png",k=function(){function e(t){Object(s.a)(this,e),this.body=void 0,this.id=void 0,this.id=t,this.body=String(t)}return Object(l.a)(e,[{key:"appendToken",value:function(e){this.body+=x+e}},{key:"appendInt",value:function(e){this.appendToken(String(e))}},{key:"appendString",value:function(e){for(var t=0,n=0;n<e.length;n++)e.charAt(n)===x&&t++;this.appendInt(t),this.appendToken(e)}}]),e}(),x="|",C=1,S=7,w=9,E=12,_=13,M=15,O=18,R=19,T=20,j=21,N=22,F=23,P=24,G=25,A=26,U=27,q=28,L=29,D=30,z=33,H=34,B=2,W=35,Z=36,Y=37,X=38,V=39,J=40,K=41,$=42,Q=42,ee=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,S))).appendInt(e),a.appendInt(n),a}return Object(h.a)(t,e),t}(k),te=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,O))).appendInt(e),n}return Object(h.a)(t,e),t}(k),ne=n(12),ae=n.n(ne),ie=n(20),re=function(){function e(t,n,a,i){Object(s.a)(this,e),this.itemId=void 0,this.itemData=void 0,this.size=void 0,this.states=void 0,this.assets=void 0,this.offset=void 0,this.itemId=t,this.itemData=n,this.size=i,this.states={},this.assets={},this.offset=a}return Object(l.a)(e,[{key:"getAvailableDirections",value:function(){var e=[],t=this.offset.visualization[this.size].directions;for(var n in t)e.push(parseInt(n));return e}},{key:"drawIcon",value:function(){return this.draw(0,0,0,!0)}},{key:"draw",value:function(e,t,n,a){var i=this.getLayers(e,t,n,a),r=document.createElement("canvas"),o=r.getContext("2d");if(r.width=1,r.height=1,null!=o){var s=1e3,l=1e3,c=0,u=1e3,h=0,d=!0,m=!1,g=void 0;try{for(var v,f=i[Symbol.iterator]();!(d=(v=f.next()).done);d=!0){var p=v.value,b=-p.asset.x,y=-p.asset.y,I=p.asset.image;if(p.asset.isFlipped){var k=p.asset.x-I.width;l>k&&(l=k)}s>b&&(s=b),u>y&&(u=y),c<b+I.width&&(c=b+I.width),h<y+I.height&&(h=y+I.height),r.width=c-s,r.height=h-u}}catch(F){m=!0,g=F}finally{try{d||null==f.return||f.return()}finally{if(m)throw g}}var x=!0,C=!1,S=void 0;try{for(var w,E=i[Symbol.iterator]();!(x=(w=E.next()).done);x=!0){var _=w.value,M=-s-_.asset.x,O=-u-_.asset.y,R=_.asset.image;if(_.asset.isFlipped){var T=le(R);null!=T&&(M=_.asset.x-R.width-l,R=T)}if(null!=_.ink&&"ADD"===_.ink?o.globalCompositeOperation="lighter":o.globalCompositeOperation="source-over",null!=_.alpha){var j=this._tintSprite(R,16777215,_.alpha);null!=j&&(R=j)}if(null!=_.color){var N=this._tintSprite(R,_.color,255);null!=N&&(R=N)}o.drawImage(R,M,O)}}catch(F){C=!0,S=F}finally{try{x||null==E.return||E.return()}finally{if(C)throw S}}}return r}},{key:"_int2rgb",value:function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}},{key:"_tintSprite",value:function(e,t,n){var a=document.createElement("canvas"),i=a.getContext("2d");if(null==i)return null;var r=this._int2rgb(t),o=e.width,s=e.height;a.width=o,a.height=s,i.drawImage(e,0,0);for(var l=i.getImageData(0,0,o,s),c=0;c<s;c++)for(var u=c*o*4,h=0;h<o;h++){u++,u++,u++,0!==l.data[u++]&&(l.data[u-1]=n,l.data[u-2]=Math.round(r.b*l.data[u-2]/255),l.data[u-3]=Math.round(r.g*l.data[u-3]/255),l.data[u-4]=Math.round(r.r*l.data[u-4]/255))}return i.putImageData(l,0,0),a}},{key:"getLayers",value:function(e,t,n,a){for(var i=[],r=me(this.itemData.classname),o=r.itemName,s=r.colorId,l=this.offset.visualization[a?1:this.size],c=a?0:-1;c<l.layerCount;c++){var u={id:c,frame:0,resourceName:""};if(-1===c&&(u.alpha=77),null!=l.layers){var h=!0,d=!1,m=void 0;try{for(var g,v=l.layers[Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var f=g.value;f.layerId===c&&(null!=f.z&&(u.z=f.z),null!=f.ink&&(u.ink=f.ink),null!=f.alpha&&(u.alpha=f.alpha),null!=f.ignoreMouse&&(u.ignoreMouse=1===f.ignoreMouse))}}catch(U){d=!0,m=U}finally{try{h||null==v.return||v.return()}finally{if(d)throw m}}}if(null!=l.directions&&null!=l.directions[e]){var p=!0,b=!1,y=void 0;try{for(var I,k=l.directions[e][Symbol.iterator]();!(p=(I=k.next()).done);p=!0){var x=I.value;x.layerId===c&&null!=x.z&&(u.z=x.z)}}catch(U){b=!0,y=U}finally{try{p||null==k.return||k.return()}finally{if(b)throw y}}}if(null!=l.colors&&null!=l.colors[s]){var C=!0,S=!1,w=void 0;try{for(var E,_=l.colors[s][Symbol.iterator]();!(C=(E=_.next()).done);C=!0){var M=E.value;M.layerId===c&&(u.color=parseInt(M.color,16))}}catch(U){S=!0,w=U}finally{try{C||null==_.return||_.return()}finally{if(S)throw w}}}if(null!=l.animations&&null!=l.animations[t]){var O=!0,R=!1,T=void 0;try{for(var j,N=l.animations[t].layers[Symbol.iterator]();!(O=(j=N.next()).done);O=!0){var F=j.value;if(F.layerId===c&&null!=F.frameSequence)if(1===F.frameSequence.length)u.frame=F.frameSequence[0][n%F.frameSequence[0].length];else for(var P=0,G=0;G<F.frameSequence.length;G++){var A=F.frameSequence[G];if(n<A.length+P&&n>P){u.frame=A[(n-P-1)%A.length];break}P+=A.length}}}catch(U){R=!0,T=U}finally{try{O||null==N.return||N.return()}finally{if(R)throw T}}}u.resourceName=oe(o,a?1:this.size,c,e,u.frame),null!=this.assets[u.resourceName]&&(u.asset=this.assets[u.resourceName],i.push(u))}return i}}]),e}(),oe=function(e,t,n,a,i){return 1===t?e+"_icon_"+se(n):e+"_"+t+"_"+se(n)+"_"+a+"_"+i},se=function(e){return-1===e?"sd":String.fromCharCode(97+e)},le=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(null==n)return null;var a=e.width,i=e.height;return t.width=a,t.height=i,n.save(),n.scale(-1,1),n.drawImage(e,0,0,-1*a,i),n.restore(),t},ce=function e(t,n,a,i){Object(s.a)(this,e),this.image=void 0,this.x=void 0,this.y=void 0,this.isFlipped=void 0,this.image=t,this.x=n,this.y=a,this.isFlipped=i},ue=function(e,t,n){var a=e.frames[n].frame,i=a.x,r=a.y,o=a.w,s=a.h,l=document.createElement("canvas");l.width=o,l.height=s;var c=l.getContext("2d");if(null!=c){l.width=o,l.height=s,c.drawImage(t,i,r,o,s,0,0,o,s);var u=new Image;return u.src=l.toDataURL(),u}return null},he=function(){function e(t){Object(s.a)(this,e),this.ready=void 0,this.bases=void 0,this.offsets=void 0,this.furnidata=void 0,this.resourcesUrl=void 0,this.resourcesUrl=t,this.ready=!1,this.bases={roomitem:{},wallitem:{}},this.furnidata={roomitemtypes:{},wallitemtypes:{}},this.offsets={}}return Object(l.a)(e,[{key:"findItemByName",value:function(e){for(var t in this.furnidata.roomitemtypes){var n=this.furnidata.roomitemtypes[t];if(n.classname===e)return{item:n,type:"roomitemtypes"}}for(var a in this.furnidata.wallitemtypes){var i=this.furnidata.wallitemtypes[a];if(i.classname===e)return{item:i,type:"wallitemtypes"}}return null}},{key:"findItemById",value:function(e,t){var n="roomitem"===e?"roomitemtypes":"wallitemtypes";return null!=this.furnidata[n][t]?this.furnidata[n][t]:null}},{key:"loadItemBase",value:function(e,t,n){var a=this,i=this.findItemById(e,t);if(null==i)return new Promise((function(e,n){n("invalid itemId "+t)}));var r=i.classname,o=me(r).itemName;return null==this.bases[e][t]&&(this.bases[e][t]=new Promise((function(e,r){null==a.offsets[o]&&(a.offsets[o]=a._fetchOffsetAsync(o)),a.offsets[o].then(function(){var r=Object(ie.a)(ae.a.mark((function r(s){var l,c,u,h,d,m,g,v,f,p,b,y,I,k,x,C,S,w,E,_,M;return ae.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(l=s.visualization[64],c={0:{count:1}},u=new re(t,i,s,n),null==l.animations){r.next=32;break}r.t0=ae.a.keys(l.animations);case 5:if((r.t1=r.t0()).done){r.next=32;break}for(h=r.t1.value,d=parseInt(h),m=1,g=!0,v=!1,f=void 0,r.prev=12,p=l.animations[d].layers[Symbol.iterator]();!(g=(b=p.next()).done);g=!0)null!=(y=b.value).frameSequence&&(I=0,y.frameSequence.forEach((function(e){I+=e.length})),m<I&&(m=I));r.next=20;break;case 16:r.prev=16,r.t2=r.catch(12),v=!0,f=r.t2;case 20:r.prev=20,r.prev=21,g||null==p.return||p.return();case 23:if(r.prev=23,!v){r.next=26;break}throw f;case 26:return r.finish(23);case 27:return r.finish(20);case 28:c[d]={count:m},null!=l.animations[d]&&null!=(k=l.animations[d].transitionTo)&&(x=k,c[d].transitionTo=x,c[x].transition=d),r.next=5;break;case 32:return r.next=34,a._downloadImageAsync(o,"atlas");case 34:for(S in C=r.sent,s.assets)w=s.assets[S],((E=w.name.split(o+"_")[1]).startsWith(n.toString())||E.startsWith("icon_"))&&(_=w,null!=w.source&&(_=s.assets[w.source]),null!=_&&_.exists&&null!=(M=ue(s.atlas,C,_.name+".png"))&&(u.assets[w.name]=new ce(M,w.x,w.y,null!=w.flipH&&1===w.flipH)));u.states=c,e(u);case 38:case"end":return r.stop()}}),r,null,[[12,16,20,28],[21,,23,27]])})));return function(e){return r.apply(this,arguments)}}()).catch((function(e){r("Error downloading offset for "+o+" reason: "+e)}))}))),this.bases[e][t]}},{key:"initialize",value:function(){var e=this,t=this._loadFiles();return Promise.all(t).then((function(){e.ready=!0}))}},{key:"_loadFiles",value:function(){var e=this;return[this._fetchJsonAsync(this.resourcesUrl+"furnidata.json").then((function(t){e.furnidata=t}))]}},{key:"_downloadImageAsync",value:function(e,t){var n=new Image,a=new Promise((function(e,t){n.onload=function(){e(n)},n.onerror=function(){t("Could not load image: "+n.src)}}));return n.crossOrigin="anonymous",n.src=this.resourcesUrl+e+"/"+t+".png",a}},{key:"_fetchJsonAsync",value:function(e){return new Promise((function(t,n){fetch(e,{method:"GET",mode:"cors",cache:"default"}).then((function(e){return e.json()})).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))}},{key:"_fetchXmlAsync",value:function(){var e=Object(ie.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){fetch(t,{method:"GET",mode:"cors",cache:"default"}).then((function(e){return e.text()})).then((function(t){return e(t)})).catch((function(e){return n(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchOffsetAsync",value:function(e){var t=this;return new Promise((function(n,a){t._fetchJsonAsync(t.resourcesUrl+e+"/furni.json").then((function(e){n(e)})).catch((function(e){return a(e)}))}))}}]),e}();!function(e){e.FloorItem="roomitem",e.WallItem="wallitem"}(a||(a={}));var de,me=function(e){var t=0;if(e.includes("*")){var n=e.split("*");e=n[0],t=parseInt(n[1])}return{itemName:e,colorId:t}},ge=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,T))).appendInt(e),n}return Object(h.a)(t,e),t}(k),ve=function(){function e(t,n,a,i,r,o,l,c,u){var h=this;Object(s.a)(this,e),this.id=void 0,this._x=void 0,this._y=void 0,this._z=void 0,this._state=void 0,this._nextState=void 0,this.rot=void 0,this._frame=void 0,this._frameCounter=void 0,this.baseId=void 0,this.sprites=void 0,this.selectableSprites=void 0,this.containers=void 0,this.selectableContainers=void 0,this.baseItem=void 0,this.loaded=void 0,this.drawAsIcon=void 0,this.colorId=void 0,this.room=void 0,this.handleClick=function(e){h.showItemInfo(!1)},this.id=t,this._x=n,this._y=a,this._z=i,this._state=o,this._nextState=-1,this.rot=r,this.baseId=l,this.baseItem=null,this.room=c,this._frame=0,this._frameCounter=0,this.loaded=!1,this.drawAsIcon=!1,this.colorId=Math.floor(16777214*Math.random())+1;var m=new d.d;m.zIndex=this.calculateZIndex(0,0);var g=new d.d;g.zIndex=m.zIndex;var v=new d.g;this.sprites=[u],this.containers=[m],this.containers[0].addChild(u),this.selectableSprites=[v],this.selectableContainers=[g],this.selectableContainers[0].addChild(v),this.updateSpritePosition()}return Object(l.a)(e,[{key:"_nextPrivateFrame",value:function(){this._frame++,-1!==this._nextState&&null!=this.baseItem&&this._frame>=this.baseItem.furniBase.states[this._state].count&&this._actuallySetState(this._nextState),this.updateTextures()}},{key:"setState",value:function(e){if(null!=this.baseItem&&null!=this.baseItem.furniBase.states[e]){var t=this.baseItem.furniBase.states[e].transition;null!=t?(this._state=t,this._frame=0,this._nextState=e):this._actuallySetState(e)}}},{key:"_actuallySetState",value:function(e){this._state=e,this._nextState=-1,this._frame=0,this.updateTextures()}},{key:"tick",value:function(e){this._frameCounter+=e,this._frameCounter>=100&&(this._nextPrivateFrame(),this._frameCounter=0)}},{key:"setAdditionalSprites",value:function(){if(null!=this.baseItem){for(var e=this.baseItem.furniBase.offset.visualization[this.baseItem.furniBase.size].layerCount+1,t=1;t<e;t++){var n=new d.g;n.visible=!1;var a=new d.g;a.visible=!1;var i=new d.d;i.addChild(n);var r=new d.d;r.addChild(a),this.sprites.push(n),this.containers.push(i),this.selectableSprites.push(a),this.selectableContainers.push(r)}this.updateTextures()}}},{key:"updateTextures",value:function(){if(null!=this.baseItem){var e=0,t=0,n=0;if(this.drawAsIcon){var a=this.sprites[n],i=this.containers[n];a.texture=this.baseItem.iconTexture,a.x=-this.baseItem.iconTexture.width/2,a.y=-this.baseItem.iconTexture.height/2,a.scale.x=1,a.blendMode=d.b.NORMAL,a.alpha=1,a.tint=16777215,i.zIndex=this.calculateZIndex(0,n),n++}else{null!=this.baseItem.furniBase.states[this._state]&&(e=this._state,t=this._frame%this.baseItem.furniBase.states[this._state].count);var r=!0,o=!1,s=void 0;try{for(var l,c=this.baseItem.furniBase.getLayers(this.rot,e,t)[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value,h=this.baseItem.getTexture(u.resourceName),m=this.baseItem.getSolidTexture(u.resourceName);if(null!=h){var g=this.sprites[n],v=this.selectableSprites[n],f=u.z||0;g.texture=h,g.visible=!0,null==m||u.ignoreMouse||(v.texture=m,v.visible=!0),g.x=-u.asset.x,g.y=-u.asset.y,v.x=-u.asset.x,v.y=-u.asset.y,u.asset.isFlipped?(g.x=u.asset.x,g.scale.x=-1,v.x=u.asset.x,v.scale.x=-1):(g.scale.x=1,v.scale.x=1),null!=u.ink&&"ADD"===u.ink?g.blendMode=d.b.ADD:g.blendMode=d.b.NORMAL,null!=u.alpha?g.alpha=u.alpha/255:g.alpha=1,null!=u.color?g.tint=u.color:g.tint=16777215,v.tint=this.colorId,this.containers[n].zIndex=this.calculateZIndex(f,n),this.selectableContainers[n].zIndex=this.containers[n].zIndex,n++}}}catch(b){o=!0,s=b}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}}for(var p=n;p<this.sprites.length;p++)this.sprites[p].visible=!1,this.selectableSprites[p].visible=!1}}},{key:"loadBase",value:function(){var e=this;return qn.getGame().baseItemManager.getItem(this.getItemType(),this.baseId).then((function(t){return e.baseItem=t,e.setAdditionalSprites(),e.updateSpritePosition(),{containers:e.containers,selectableContainers:e.selectableContainers}}))}},{key:"startMovement",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.containers[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){a.value.alpha=.7}}catch(r){t=!0,n=r}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"stopMovement",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.containers[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){a.value.alpha=1}}catch(r){t=!0,n=r}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"showItemInfo",value:function(e){if(null!=this.baseItem){var t=Object.keys(this.baseItem.furniBase.states).length;qn.getGame().uiManager.onSelectFurni(this.id,this.baseId,this.baseItem.furniBase.itemData.name,this.baseItem.furniBase.itemData.description,this.baseItem.infoImage,e,!0,this.getItemType()===a.FloorItem,!0,1!==t)}}},{key:"handleHover",value:function(e){}},{key:"handleDoubleClick",value:function(e){qn.getGame().communicationManager.sendMessage(new te(this.id))}},{key:"pickUp",value:function(){qn.getGame().communicationManager.sendMessage(new ge(this.id))}}]),e}(),fe=function(e){function t(e,n,a,i){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(u.a)(t).call(this,R))).appendInt(e),r.appendInt(n),r.appendInt(a),r.appendInt(i),r}return Object(h.a)(t,e),t}(k),pe=function(e){function t(e,n,a,i,r,o,l,h){Object(s.a)(this,t);var m=new d.g;return m.texture=qn.getGame().engine.getTexture(g),m.x=v,m.y=f,Object(c.a)(this,Object(u.a)(t).call(this,e,n,a,i,r,o,l,h,m))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"updateSpritePosition",value:function(){var e=this.room.engine.tileToLocal(this._x,this._y,this._z),t=e.x+be,n=e.y+ye;this.drawAsIcon&&(t=this._x,n=this._y);var a=!0,i=!1,r=void 0;try{for(var o,s=this.containers[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;l.x=t,l.y=n}}catch(v){i=!0,r=v}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}var c=!0,u=!1,h=void 0;try{for(var d,m=this.selectableContainers[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){var g=d.value;g.x=t,g.y=n}}catch(v){u=!0,h=v}finally{try{c||null==m.return||m.return()}finally{if(u)throw h}}}},{key:"updatePosition",value:function(e,t,n,a,i){this._x=e,this._y=t,this._z=n,this.rot=a,this.drawAsIcon=i,this.updateSpritePosition(),this.updateTextures()}},{key:"calculateZIndex",value:function(e,t){return Ce(this._x,this._y,this._z,e,t)}},{key:"getItemType",value:function(){return a.FloorItem}},{key:"rotate",value:function(){null!=this.baseItem&&qn.getGame().communicationManager.sendMessage(new fe(this.id,this._x,this._y,this.baseItem.calculateNextDirection(this.rot)))}}]),t}(ve),be=32,ye=16,Ie=function(){function e(t){var n=this;Object(s.a)(this,e),this.room=void 0,this.container=void 0,this.selectableContainer=void 0,this.floorSprites=void 0,this.wallSprites=void 0,this.selectedTileSprite=void 0,this.lastMousePositionX=void 0,this.lastMousePositionY=void 0,this.userSprites=void 0,this.shadowSprites=void 0,this.roomItemSprites=void 0,this.selectableSprites=void 0,this.selectableItems=void 0,this.currentSelectedItem=void 0,this.movingItem=void 0,this.movingItemPosition=void 0,this.wallPoints=void 0,this.maxHeight=void 0,this.handleMouseMovement=function(e,t,a){var i=n.globalToTileStrict(e,t),r=n.getSelectableColorId(e,t),o=null;if(-1!==r&&null!=(o=n.selectableItems[r])&&o.handleHover(r),a){var s=Math.round(n.lastMousePositionX-e),l=Math.round(n.lastMousePositionY-t);n.container.x-=s,n.container.y-=l,n.selectableContainer.x=n.container.x,n.selectableContainer.y=n.container.y}n.lastMousePositionX=Math.round(e),n.lastMousePositionY=Math.round(t),n.updateMovingItem(e,t),null!=i?n.updateSelectedTile(i.x,i.y):n.hideSelectedTile()},this.handleMouseClick=function(e,t,a,i,r,o){var s=n.globalToTile(e,t),l=s.x,c=s.y,u=n.room.model.isValidTile(l,c);if(n.isMovingRoomItem())return n.finishRoomItemMovement(e,t),null;var h=n.getSelectableColorId(e,t),d=null;return-1!==h&&null!=(d=n.selectableItems[h])&&(a?d instanceof pe&&d.rotate():i?d instanceof ve&&d.pickUp():r&&d instanceof ve&&n.startRoomItemMove(d),d.handleClick(h)),u&&qn.getGame().communicationManager.sendMessage(new ee(l,c)),o&&qn.getGame().uiManager.onFocusChat(),d},this.handleTouchMove=function(e,t){e=Math.floor(e),t=Math.floor(t),n.handleMouseMovement(e,t,!0)},this.handleTouchStart=function(e,t){e=Math.floor(e),t=Math.floor(t),n.handleMouseMovement(e,t,!1);var a=n.handleMouseClick(e,t,!1,!1,!1,!1);a===n.currentSelectedItem&&n.handleMouseDoubleClick(e,t),n.currentSelectedItem=a},this.handleMouseDoubleClick=function(e,t){var a=n.globalToTile(e,t),i=a.x,r=a.y,o=n.getSelectableColorId(e,t),s=n.selectableItems[o];null!=s?s.handleDoubleClick(o):n.room.model.isValidTile(i,r)||n.centerCamera()},this.room=t,this.container=new d.d,this.selectableContainer=new d.d,this.floorSprites=[],this.wallSprites=[],this.userSprites={},this.shadowSprites={},this.roomItemSprites={},this.selectableSprites={},this.selectableItems={},this.lastMousePositionX=0,this.lastMousePositionY=0,this.maxHeight=1,this.movingItem=null,this.movingItemPosition={x:0,y:0,z:0,rot:0},this.wallPoints=[],this.container.sortableChildren=!0,this.selectableContainer.sortableChildren=!0,this.onResize(),this.setWalls(),this.setFloor(),this.setSelectedTile()}return Object(l.a)(e,[{key:"onResize",value:function(){this.centerCamera()}},{key:"centerCamera",value:function(){var e=this.room,t=e.model,n=e.roomUserManager,a=qn.getGame().userManager.currentUser,i=this.tileToLocal(t.doorX,t.doorY,0),r=i.x,o=i.y;if(null!=a&&null!=n){var s=n.getUser(a.id);if(null!=s){var l=this.tileToLocal(s._x,s._y,s._z);r=l.x,o=l.y}}this.container.x=Math.round((m.getViewportWidth()-(r+0))/2),this.container.y=Math.round((m.getViewportHeight()-(o+150))/2),this.selectableContainer.x=this.container.x,this.selectableContainer.y=this.container.y}},{key:"setSelectedTile",value:function(){var e=qn.getGame().engine.getTexture("assets/selected_tile.png");this.selectedTileSprite=new d.g(e),this.selectedTileSprite.visible=!1,this.container.addChild(this.selectedTileSprite)}},{key:"setChatContainer",value:function(e){e.zIndex=we(),this.container.addChild(e)}},{key:"addUserContainer",value:function(e,t,n){this.userSprites[e]=t,this.shadowSprites[e]=n,this.container.addChild(t),this.container.addChild(n)}},{key:"addRoomItemContainerSet",value:function(e,t){this.roomItemSprites[e]=t;var n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;this.container.addChild(s)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}},{key:"addSelectableContainer",value:function(e,t,n){this.selectableSprites[e]=t,this.selectableItems[e]=n;var a=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;this.selectableContainer.addChild(l)}}catch(c){i=!0,r=c}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"startRoomItemMove",value:function(e){this.cancelRoomItemMove(),this.movingItem=e,this.movingItemPosition={x:e._x,y:e._y,z:e._z,rot:e.rot},this.movingItem.startMovement()}},{key:"cancelRoomItemMove",value:function(){if(null!=this.movingItem){var e=this.movingItemPosition,t=e.x,n=e.y,a=e.z,i=e.rot;this.movingItem.updatePosition(t,n,a,i,!1),this.movingItem.stopMovement(),this.room.roomItemManager.cancelRoomItemMovement(this.movingItem),this.movingItem=null}}},{key:"finishRoomItemMovement",value:function(e,t){if(null!=this.movingItem){if(this.movingItem instanceof pe){var n=this.globalToTile(e,t),a=n.x,i=n.y;if(this.canPlaceFloorItem(a,i,this.movingItem)){var r=this.room.model.heightMap[a][i]-1;this.movingItem.updatePosition(a,i,r,this.movingItemPosition.rot,!1),this.room.roomItemManager.finishRoomItemMovement(this.movingItem)}else this.cancelRoomItemMove()}else{var o=this.globalToLocal(e,t),s=o.x,l=o.y;this.canPlaceWallItem(e,t)?(this.movingItem.updatePosition(s,l,0,this.calculateWallDirection(e,t),!1),this.room.roomItemManager.finishRoomItemMovement(this.movingItem)):this.cancelRoomItemMove()}this.movingItem=null}}},{key:"isMovingRoomItem",value:function(){return null!=this.movingItem}},{key:"updateMovingItem",value:function(e,t){if(null!=this.movingItem)if(this.movingItem instanceof pe){var n=this.globalToTile(e,t),a=n.x,i=n.y;if(this.canPlaceFloorItem(a,i,this.movingItem)){var r=this.room.model.heightMap[a][i]-1;this.movingItem.updatePosition(a,i,r,this.movingItemPosition.rot,!1)}else{var o=this.globalToLocal(e,t);this.movingItem.updatePosition(o.x,o.y,0,this.movingItemPosition.rot,!0)}}else{var s=this.globalToLocal(e,t),l=s.x,c=s.y;this.canPlaceWallItem(e,t)?this.movingItem.updatePosition(l,c,0,this.calculateWallDirection(e,t),!1):this.movingItem.updatePosition(l,c,0,this.calculateWallDirection(e,t),!0)}}},{key:"calculateWallDirection",value:function(e,t){var n=this.globalToLocal(e,t),a=this.localToWall(n.x,n.y);a.x--;var i=!0,r=!1,o=void 0;try{for(var s,l=this.wallPoints[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=this.tileToLocal(c.x,c.y,c.z),h=this.localToWall(u.x,u.y);if(4===c.rot){var d=a.x-h.x;if(d<1.1&&d>0)return 4}}}catch(m){r=!0,o=m}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return 2}},{key:"canPlaceWallItem",value:function(e,t){var n=this.globalToLocal(e,t),a=this.localToWall(n.x,n.y),i=this.localToWall(-n.x,n.y);a.x--;var r=!0,o=!1,s=void 0;try{for(var l,c=this.wallPoints[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value,h=this.tileToLocal(u.x,u.y,u.z);if(4===u.rot){var d=this.localToWall(h.x,h.y),m=a.x-d.x,g=a.y-d.y,v=this.maxHeight-u.z-1;if(m<1.1&&m>0&&g<-.5&&g>-4-v)return!0}else{var f=this.localToWall(-h.x,h.y),p=f.x-i.x,b=i.y-f.y,y=this.maxHeight-u.z-1;if(p<1.1&&p>0&&b<.5&&b>-3-y)return!0}}}catch(I){o=!0,s=I}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}return!1}},{key:"canPlaceFloorItem",value:function(e,t,n){var a=this.room.model,i=e,r=t;if(null!=n.baseItem){var o=n.baseItem.furniBase.offset.logic.dimensions.x,s=n.baseItem.furniBase.offset.logic.dimensions.y;o>1&&(0!==n.rot&&4!==n.rot||(i+=o-1),2!==n.rot&&6!==n.rot||(r+=o-1)),s>1&&(0!==n.rot&&4!==n.rot||(r+=o-1),2!==n.rot&&6!==n.rot||(i+=o-1))}return a.isValidTile(e,t)&&a.isValidTile(i,r)}},{key:"removeSelectableContainer",value:function(e){var t=this.selectableSprites[e];if(null!=t){var n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;this.selectableContainer.removeChild(s)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}delete this.selectableSprites[e]}null!=this.selectableItems[e]&&delete this.selectableItems[e]}},{key:"removeRoomItemContainerSet",value:function(e){var t=this.roomItemSprites[e];if(null!=t){var n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;this.container.removeChild(s)}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}delete this.roomItemSprites[e]}}},{key:"removeUserSprite",value:function(e){var t=this.userSprites[e],n=this.shadowSprites[e];null!=t&&(this.container.removeChild(t),delete this.userSprites[e]),null!=n&&(this.container.removeChild(n),delete this.shadowSprites[e])}},{key:"_addWallSprite",value:function(e,t,n,a,i,r,o){var s=new d.g(e),l=this.tileToLocal(t,n,a);s.x=l.x+i,s.y=l.y+r,s.zIndex=ke(t,n,0,o),this.wallSprites.push(s),this.container.addChild(s)}},{key:"setWalls",value:function(){for(var e=qn.getGame().roomImager,t=this.room.model,n=t.maxX,a=1,i=0;i<t.maxX;i++)for(var r=0;r<t.maxY;r++){var o=t.heightMap[i][r];o>a&&(a=o)}this.maxHeight=a;for(var s=0;s<t.maxX;s++)for(var l=0;l<t.maxY;l++){var c=t.heightMap[s][l];(t.doorX!==s||t.doorY!==l)&&c>0&&l<=n&&(n>l&&(n=l),this._addWallSprite(e.generateRoomWallR(a-c),s,l+1,a-1,64,-135,Re),this.wallPoints.push({x:s,y:l,z:c-1,rot:4}))}for(var u=t.maxX,h=0;h<t.maxY;h++)for(var d=0;d<t.maxX;d++){var m=t.heightMap[d][h];if((t.doorX!==d||t.doorY!==h)&&m>0&&d<=u){u>d&&(u=d),h===t.doorY?this._addWallSprite(e.generateRoomDoorL(),d,h,a-1,-8,-119,Re):h===t.doorY-1?this._addWallSprite(e.generateRoomDoorBeforeL(a-m),d,h,a-1,-8,-119,Re):this._addWallSprite(e.generateRoomWallL(a-m),d,h,a-1,-8,-119,Re),this.wallPoints.push({x:d,y:h,z:m-1,rot:2});break}}}},{key:"setFloor",value:function(){var e=qn.getGame().roomImager,t=e.roomTileTexture,n=e.roomStairLTexture,a=e.roomStairRTexture;this.floorSprites=[];for(var i=this.room.model,r=0;r<i.maxX;r++)for(var o=0;o<i.maxY;o++){var s=i.heightMap[r][o];if(s>0)if(i.isValidTile(r+1,o)&&i.heightMap[r+1][o]<s){var l=new d.g(n),c=this.tileToLocal(r,o,s-1);l.x=c.x,l.y=c.y,l.zIndex=ke(r,o,0,i.doorX===r&&i.doorY===o?Ee:Te),this.floorSprites.push(l),this.container.addChild(l)}else if(i.isValidTile(r-1,o)&&i.heightMap[r-1][o]>s);else if(i.isValidTile(r,o-1)&&i.heightMap[r][o-1]>s);else if(i.isValidTile(r,o+1)&&i.heightMap[r][o+1]<s){var u=new d.g(a),h=this.tileToLocal(r,o,s-1);u.x=h.x-34,u.y=h.y+0,u.zIndex=ke(r,o,0,i.doorX===r&&i.doorY===o?Ee:Te),this.floorSprites.push(u),this.container.addChild(u)}else{var m=new d.g(t),g=this.tileToLocal(r,o,s-1);m.x=g.x,m.y=g.y,m.zIndex=ke(r,o,0,i.doorX===r&&i.doorY===o?Ee:Te),this.floorSprites.push(m),this.container.addChild(m)}}}},{key:"tileToLocal",value:function(e,t,n){return new d.f(32*(e-t),16*(e+t)-16*n*2)}},{key:"globalToTileStrict",value:function(e,t){for(var n=this.room.model,a=this.maxHeight;a>=0;a--){var i=this.globalToTileWithHeight(e,t,a);if(n.isValidTile(i.x,i.y)&&n.heightMap[i.x][i.y]===a+1)return i}return null}},{key:"globalToTile",value:function(e,t){for(var n=this.room.model,a=this.globalToTileWithHeight(e,t,0),i=this.maxHeight;i>=1;i--){var r=this.globalToTileWithHeight(e,t,i);if(n.isValidTile(r.x,r.y)&&n.heightMap[r.x][r.y]===i+1)return r}return a}},{key:"globalToTileWithHeight",value:function(e,t,n){var a=(e-32-this.container.x)/32,i=(t-(this.container.y-16*n*2))/16,r=Math.floor((a+i)/2),o=Math.floor((i-a)/2);return new d.f(r,o)}},{key:"localToWall",value:function(e,t){var n=e/32,a=t/32-e/64;return new d.f(n,a)}},{key:"globalToLocal",value:function(e,t){var n=this.container.x,a=this.container.y;return new d.f(e-n,t-a)}},{key:"getSelectableColorId",value:function(e,t){var n=qn.getGame().engine.logicPixiApp.renderer.extract.pixels(this.getLogicStage()),a=this.getLogicStage().getBounds(),i=Math.floor(e-a.x),r=Math.floor(t-a.y),o=4*(r*a.width+i);return i>=0&&r>=0&&i<=a.width&&r<=a.height?Se(n[o],n[o+1],n[o+2]):-1}},{key:"hideSelectedTile",value:function(){null!=this.selectedTileSprite&&(this.selectedTileSprite.visible=!1)}},{key:"updateSelectedTile",value:function(e,t){if(null!=this.selectedTileSprite){var n=this.room.model,a=n.isValidTile(e,t);if(this.selectedTileSprite.visible=a,a){var i=this.tileToLocal(e,t,n.heightMap[e][t]-1);this.selectedTileSprite.x=i.x+0,this.selectedTileSprite.y=i.y+-3}this.selectedTileSprite.zIndex=ke(e,t,0,n.doorX===e&&n.doorY===t?_e:Fe)}}},{key:"tick",value:function(e){}},{key:"getStage",value:function(){return this.container}},{key:"getLogicStage",value:function(){return this.selectableContainer}},{key:"calculateZIndexUser",value:function(e,t,n){var a=this.room.model;return xe(e,t,n,a.doorX===e&&a.doorY===t?Oe:Pe)}},{key:"calculateZIndexUserShadow",value:function(e,t,n){var a=this.room.model;return xe(e,t,n,a.doorX===e&&a.doorY===t?Me:je)}}]),e}(),ke=function(e,t,n,a){return(e+t)*qe+n*Le+Ue*a},xe=function(e,t,n,a){return ke(Math.floor(e),Math.floor(t),n+.001,a)},Ce=function(e,t,n,a,i){var r=Math.trunc(a/100)/10;return ke(e,t+r,n,Ge)},Se=function(e,t,n){return(e<<16)+(t<<8)+n},we=function(){return Ae*Ue},Ee=1,_e=2,Me=3,Oe=4,Re=6,Te=7,je=8,Ne=9,Fe=11,Pe=11,Ge=11,Ae=13,Ue=1e7,qe=1e6,Le=1e4,De=function e(t,n,a,i,r,o,l,c,u){switch(Object(s.a)(this,e),this.direction=void 0,this.headDirection=void 0,this.action=void 0,this.gesture=void 0,this.frame=void 0,this.isHeadOnly=void 0,this.isBodyOnly=void 0,this.scale=void 0,this.isDownsampled=void 0,this.isLarge=void 0,this.isSmall=void 0,this.rectWidth=void 0,this.rectHeight=void 0,this.figure=void 0,this.drawAction=void 0,this.handItem=void 0,this.drawOrder=void 0,this.direction=n,this.headDirection=a,this.isHeadOnly=l,this.isBodyOnly=c,this.scale=u,this.isDownsampled=!1,this.isLarge=!1,this.isSmall=!1,this.rectWidth=64,this.rectHeight=110,u){case"l":this.isLarge=!0,this.rectWidth=128,this.rectHeight=220;break;case"s":this.isSmall=!0,this.rectWidth=32,this.rectHeight=55;break;case"d":this.isDownsampled=!0}switch(this.figure=ze(t),this.frame=o,this.drawAction={body:"std"},this.handItem=-1,this.drawOrder="std",this.gesture=r,r){case"spk":this.drawAction.speak="spk";break;case"eyb":this.drawAction.eye="eyb";break;case"":this.drawAction.gesture="std";break;default:this.drawAction.gesture=r}this.action=i;var h=!0,d=!1,m=void 0;try{for(var g,v=this.action[Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var f=g.value.split("=");switch(f[0]){case"wlk":this.drawAction.wlk="wlk";break;case"sit":this.drawAction.sit="sit";break;case"lay":this.drawAction.body="lay",this.drawAction.eye="lay";var p=this.rectWidth;switch(this.rectWidth=this.rectHeight,this.rectHeight=p,this.gesture){case"spk":this.drawAction.speak="lsp";break;case"eyb":this.drawAction.eye="ley";break;case"std":this.drawAction.gesture="lay";break;default:this.drawAction.gesture="l"+this.gesture.substr(0,2)}break;case"wav":this.drawAction.handLeft="wav";break;case"crr":case"drk":this.drawAction.handRight=f[0],this.drawAction.itemRight=f[0],this.handItem=Number(f[1]);break;case"swm":this.drawAction.swm="swm","spk"===this.gesture&&(this.drawAction.speak="sws");break;case"":this.drawAction.body="std";break;default:this.drawAction.body=f[0]}}}catch(b){d=!0,m=b}finally{try{h||null==v.return||v.return()}finally{if(d)throw m}}"sit"===this.drawAction.sit&&(this.direction>=2&&this.direction<=4?(this.drawOrder="sit","drk"===this.drawAction.handRight&&this.direction>=2&&this.direction<=3?this.drawOrder+=".rh-up":this.drawAction.handLeft&&4===this.direction&&(this.drawOrder+=".lh-up")):"lay"===this.drawAction.body?this.drawOrder="lay":"drk"===this.drawAction.handRight&&this.direction>=0&&this.direction<=3?this.drawOrder="rh-up":this.drawAction.handLeft&&this.direction>=4&&this.direction<=6&&(this.drawOrder="lh-up"))},ze=function(e){var t={},n=[],a=!0,i=!1,r=void 0;try{for(var o,s=e.split(".")[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value.split("-"),c={type:l[0],id:l[1],colors:[l[2]]};null!=l[3]&&c.colors.push(l[3]),t[c.type]=c}}catch(h){i=!0,r=h}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}for(var u in t)n.push(t[u]);return n},He=function(e){var t="",n=!0,a=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,l=s.type+"-"+s.id,c=!0,u=!1,h=void 0;try{for(var d,m=s.colors[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){l+="-"+d.value}}catch(g){u=!0,h=g}finally{try{c||null==m.return||m.return()}finally{if(u)throw h}}t+=l+"."}}catch(g){a=!0,i=g}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return t.substr(0,t.length-1)},Be=function(e,t,n,a){var i=document.createElement("canvas"),r=i.getContext("2d"),o=e.width,s=e.height;if(null==r||0===o||0===s)return e;i.width=o,i.height=s,r.drawImage(e,0,0);for(var l=r.getImageData(0,0,o,s),c=0;c<s;c++)for(var u=c*o*4,h=0;h<o;h++){u+=3,0!==l.data[u++]&&(l.data[u-1]=255,l.data[u-2]=a,l.data[u-3]=n,l.data[u-4]=t)}return r.putImageData(l,0,0),i},We=function(){function e(t,n){Object(s.a)(this,e),this.look=void 0,this.isGhost=void 0,this.color=void 0,this.bodyTextures=void 0,this.headTextures=void 0,this.solidBodyTextures=void 0,this.solidHeadTextures=void 0,this.headImage=void 0,this.userInfoImage=void 0,this.isGhost=void 0!==n&&n,this.look=n?Xe:t,this.bodyTextures={},this.headTextures={},this.solidBodyTextures={},this.solidHeadTextures={},this.color=0,this.headImage=document.createElement("canvas"),this.userInfoImage=document.createElement("canvas")}return Object(l.a)(e,[{key:"initialize",value:function(){for(var e=[],t=qn.getGame().avatarImager,n=0;n<=7;n++){e.push(this._loadUniqueHeadTexture(n,"std",0)),e.push(this._loadUniqueHeadTexture(n,"eyb",0)),e.push(this._loadUniqueBodyTexture(n,["std"],0));for(var a=0;a<=3;a++)e.push(this._loadUniqueBodyTexture(n,["wlk"],a)),e.push(this._loadUniqueBodyTexture(n,["wlk","wav"],a));for(var i=0;i<=1;i++)e.push(this._loadUniqueBodyTexture(n,["wav"],i)),e.push(this._loadUniqueHeadTexture(n,"spk",i))}for(var r=0;r<=7;r+=2){e.push(this._loadUniqueBodyTexture(r,["sit"],0));for(var o=0;o<=1;o++)e.push(this._loadUniqueBodyTexture(r,["sit","wav"],o))}return e.push(this._loadChatHeadImage()),e.push(this._loadUserInfoImage()),this.color=t.getChatColor(this.look),Promise.all(e)}},{key:"getSolidHeadTexture",value:function(e,t,n){return this.solidHeadTextures[Ye(e,t,n)]}},{key:"getSolidBodyTexture",value:function(e,t,n){return this.solidBodyTextures[Ze(e,t,n)]}},{key:"getHeadTexture",value:function(e,t,n){return this.headTextures[Ye(e,t,n)]}},{key:"getBodyTexture",value:function(e,t,n){return this.bodyTextures[Ze(e,t,n)]}},{key:"_loadUniqueBodyTexture",value:function(e,t,n){var a=this,i=qn.getGame(),r=i.avatarImager,o=i.engine;return r.generateGeneric(new De(this.look,e,e,t,"std",n,!1,!0,"n"),this.isGhost).then((function(i){a.bodyTextures[Ze(e,t,n)]=o.getTextureFromImage(i),a.solidBodyTextures[Ze(e,t,n)]=o.getTextureFromImage(Be(i,255,255,255))}))}},{key:"_loadUniqueHeadTexture",value:function(e,t,n){var a=this,i=qn.getGame(),r=i.avatarImager,o=i.engine;return r.generateGeneric(new De(this.look,e,e,["std"],t,n,!0,!1,"n"),this.isGhost).then((function(i){a.headTextures[Ye(e,t,n)]=o.getTextureFromImage(i),a.solidHeadTextures[Ye(e,t,n)]=o.getTextureFromImage(Be(i,255,255,255))}))}},{key:"_loadChatHeadImage",value:function(){var e=this;return qn.getGame().avatarImager.generateGeneric(new De(this.look,2,2,["std"],"std",0,!0,!1,"d"),this.isGhost).then((function(t){e.headImage=t}))}},{key:"_loadUserInfoImage",value:function(){var e=this;return qn.getGame().avatarImager.generateGeneric(new De(this.look,4,4,["std"],"std",0,!1,!1,"n"),this.isGhost).then((function(t){e.userInfoImage=t}))}}]),e}(),Ze=function(e,t,n){var a=t[0];return t.length>1&&(a+="-"+t[1]),e+"_"+a+"_"+n},Ye=function(e,t,n){return e+"_"+t+"_"+n},Xe="hd-180-1021",Ve=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,E))).appendInt(e),n}return Object(h.a)(t,e),t}(k),Je=function(){function e(t,n,a,i,r,o){var l=this;Object(s.a)(this,e),this.user=void 0,this._x=void 0,this._y=void 0,this._z=void 0,this._seatZ=void 0,this.targetX=void 0,this.targetY=void 0,this.targetZ=void 0,this.rot=void 0,this.headRot=void 0,this.status=void 0,this._frame=void 0,this._frameCounter=void 0,this._waveCounter=void 0,this._speakCounter=void 0,this._signCounter=void 0,this.avatarContainer=void 0,this.container=void 0,this.headSprite=void 0,this.bodySprite=void 0,this.shadowSprite=void 0,this.signSprite=void 0,this.selectableContainer=void 0,this.selectableHeadSprite=void 0,this.selectableBodySprite=void 0,this.colorId=void 0,this.loaded=void 0,this.room=void 0,this.handleClick=function(e){qn.getGame().communicationManager.sendMessage(new Ve(l.user.id)),l.showUserInfo(!1)},this.showUserInfo=function(e){var t=qn.getGame().userManager.currentUser===l.user;qn.getGame().uiManager.onSelectUser(l.user.id,l.user.name,l.user.motto,l.user.look,t,l.avatarContainer.userInfoImage,e)},this.handleHover=function(e){l.showSign(1)},this.handleDoubleClick=function(e){},this.user=t,this._x=n,this._y=a,this._z=i,this.targetX=n,this.targetY=a,this.targetZ=i,this._seatZ=0,this.rot=r,this.headRot=r,this.room=o,this.status={},this._frame=0,this._frameCounter=0,this._waveCounter=0,this._speakCounter=0,this._signCounter=0,this.colorId=Math.floor(16777214*Math.random())+1,this.loaded=!1,this.bodySprite=new d.g,this.headSprite=new d.g,this.selectableBodySprite=new d.g,this.selectableHeadSprite=new d.g,this.shadowSprite=new d.g(qn.getGame().engine.getTexture(I)),this.selectableContainer=new d.d,this.selectableContainer.addChild(this.selectableBodySprite),this.selectableContainer.addChild(this.selectableHeadSprite);var c=qn.getGame().meMenuImager.generateSign(this.user.name),u=qn.getGame().engine.getTextureFromImage(c);this.signSprite=new d.g(u),this.signSprite.y=-20,this.signSprite.x=Math.floor(-c.width/2+32),this.avatarContainer=new We(this.user.look),this.container=new d.d,this.container.addChild(this.bodySprite),this.container.addChild(this.headSprite),this.container.addChild(this.signSprite),this.showSign(5),this.updateTexture(),this.updateSpritePosition()}return Object(l.a)(e,[{key:"_nextPrivateFrame",value:function(){this._frame++,this.updateTexture()}},{key:"tick",value:function(e){this._frameCounter+=e,this._frameCounter>=100&&(this._nextPrivateFrame(),this._frameCounter=0),this._waveCounter>0&&(this._waveCounter-=e),this._speakCounter>0&&(this._speakCounter-=e),this._signCounter>0&&(this._signCounter-=e),this.isWalking()&&this.move(e)}},{key:"wave",value:function(e){this._waveCounter=1e3*e}},{key:"speak",value:function(e){this._speakCounter=1e3*e}},{key:"showSign",value:function(e){this._signCounter=1e3*e}},{key:"updateStatus",value:function(e,t,n,a,i){if(this._x=e,this._y=t,this._z=n,this.rot=a,this.headRot=a,this.status=i,null!=i.sit?this._seatZ=parseFloat(i.sit)-1:this._seatZ=0,null!=i.mv){var r=i.mv.split(",");this.setMovement(parseInt(r[0]),parseInt(r[1]),parseFloat(r[2])),this._seatZ=0}this.updateTexture(),this.updateSpritePosition()}},{key:"setMovement",value:function(e,t,n){this.targetX=e,this.targetY=t,this.targetZ=n}},{key:"isSitting",value:function(){return null!=this.status.sit}},{key:"isWalking",value:function(){return null!=this.status.mv}},{key:"isWaving",value:function(){return this._waveCounter>0}},{key:"isSpeaking",value:function(){return this._speakCounter>0}},{key:"isShowingSign",value:function(){return this._signCounter>0}},{key:"loadTextures",value:function(){var e=this;return this.avatarContainer.initialize().then((function(){e.loaded=!0,e.updateTexture()}))}},{key:"updateTexture",value:function(){var e=["std"],t="std",n=0,a=0;this.isSitting()&&(e=["sit"]),this.isWaving()&&(e=["wav"],n=this._frame%2,this.isSitting()&&(e=["sit","wav"],n=this._frame%2)),this.isSpeaking()?(t="spk",a=this._frame%2):this._frame%40<2&&(t="eyb"),this.isWalking()&&(e=["wlk"],n=this._frame%4,this.isWaving()&&(e=["wlk","wav"])),this.signSprite.visible=this.isShowingSign(),this.loaded?(this.bodySprite.texture=this.avatarContainer.getBodyTexture(this.rot,e,n),this.headSprite.texture=this.avatarContainer.getHeadTexture(this.headRot,t,a),this.selectableBodySprite.tint=this.colorId,this.selectableHeadSprite.tint=this.colorId,this.selectableBodySprite.texture=this.avatarContainer.getSolidBodyTexture(this.rot,e,n),this.selectableHeadSprite.texture=this.avatarContainer.getSolidHeadTexture(this.headRot,t,a)):(this.bodySprite.texture=qn.getGame().ghostTextures.getBodyTexture(this.rot,e,n),this.headSprite.texture=qn.getGame().ghostTextures.getHeadTexture(this.headRot,t,a))}},{key:"getSpriteX",value:function(){return this.container.x}},{key:"updateSpritePosition",value:function(){var e=this.room.engine.tileToLocal(this._x,this._y,this._z+this._seatZ),t=e.x,n=e.y,a=6===this.rot||5===this.rot||4===this.rot?3:0;this.container.x=Math.round(t+a),this.container.y=Math.round(n+-85),this.selectableContainer.x=this.container.x,this.selectableContainer.y=this.container.y;var i=this._z;this.room.model.isValidTile(Math.floor(this._x),Math.floor(this._y))&&(i=Math.min(this.room.model.heightMap[Math.floor(this._x)][Math.floor(this._y)]-1,i));var r=this.room.engine.tileToLocal(this._x,this._y,i);this.shadowSprite.x=r.x,this.shadowSprite.y=r.y,this.shadowSprite.zIndex=this.room.engine.calculateZIndexUserShadow(this._x,this._y,0),this.container.zIndex=this.room.engine.calculateZIndexUser(this._x,this._y,this._z),this.selectableContainer.zIndex=this.container.zIndex}},{key:"move",value:function(e){e/=1e3,this.targetX>this._x?(this._x+=2*e,this._x>this.targetX&&(this._x=this.targetX)):this.targetX<this._x&&(this._x+=-2*e,this._x<this.targetX&&(this._x=this.targetX)),this.targetY>this._y?(this._y+=2*e,this._y>this.targetY&&(this._y=this.targetY)):this.targetY<this._y&&(this._y-=2*e,this._y<this.targetY&&(this._y=this.targetY)),this.targetZ>this._z?(this._z+=2*e,this._z>this.targetZ&&(this._z=this.targetZ)):this.targetZ<this._z&&(this._z-=2*e,this._z<this.targetZ&&(this._z=this.targetZ)),this.updateSpritePosition()}}]),e}(),Ke=function(){function e(t){Object(s.a)(this,e),this.room=void 0,this.users=void 0,this.room=t,this.users={}}return Object(l.a)(e,[{key:"getUser",value:function(e){return e in this.users?this.users[e]:null}},{key:"updateUserStatus",value:function(e,t,n,a,i,r){var o=this.getUser(e);null!=o&&o.updateStatus(t,n,a,i,r)}},{key:"addUserToRoom",value:function(e,t,n,a,i,r,o,s){var l=qn.getGame().userManager.setUser(e,r,s,o),c=this.getUser(e);null!=c&&this.removeUserFromRoom(e,!1);var u=new Je(l,t,n,a,i,this.room);this.room.engine.addUserContainer(e,u.container,u.shadowSprite),this.room.engine.addSelectableContainer(u.colorId,[u.selectableContainer],u),this.users[e]=u,u.loadTextures().then((function(){null!=c&&u.showUserInfo(!0)}))}},{key:"userWave",value:function(e){var t=this.getUser(e);null!=t&&t.wave(2)}},{key:"removeUserFromRoom",value:function(e,t){this.room.engine.removeUserSprite(e);var n=this.getUser(e);null!=n&&(this.room.engine.removeSelectableContainer(n.colorId),t&&qn.getGame().uiManager.onCloseSelectUser(e),delete this.users[e])}},{key:"tick",value:function(e){for(var t in this.users)null!=this.users[t]&&this.users[t].tick(e)}}]),e}(),$e=function(e){function t(e,n,a,i,r,o,l){Object(s.a)(this,t);var h=new d.g;return h.texture=qn.getGame().engine.getTexture(p),h.x=b,h.y=y,4===i&&(h.scale.x=-1,h.x=-b),Object(c.a)(this,Object(u.a)(t).call(this,e,n,a,0,i,r,o,l,h))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"updateSpritePosition",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.containers[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var r=a.value;r.x=this._x,r.y=this._y}}catch(d){t=!0,n=d}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}var o=!0,s=!1,l=void 0;try{for(var c,u=this.selectableContainers[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;h.x=this._x,h.y=this._y}}catch(d){s=!0,l=d}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}},{key:"calculateZIndex",value:function(e,t){return n=this.id,this._x,this._y,n*Le+t+Ue*Ne;var n}},{key:"getItemType",value:function(){return a.WallItem}},{key:"rotate",value:function(){}},{key:"updatePosition",value:function(e,t,n,a,i){this._x=e,this._y=t,this._z=n,this.rot=a,this.drawAsIcon=i,this.updateSpritePosition(),this.updateTextures()}}]),t}(ve),Qe=function(e){function t(e,n,a,i){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(u.a)(t).call(this,P))).appendInt(e),r.appendInt(n),r.appendInt(a),r.appendInt(i),r}return Object(h.a)(t,e),t}(k),et=function(){function e(t){Object(s.a)(this,e),this.room=void 0,this.items=void 0,this.currentPlacingItem=void 0,this.room=t,this.items={}}return Object(l.a)(e,[{key:"getItem",value:function(e){return e in this.items?this.items[e]:null}},{key:"startRoomItemMovement",value:function(e){var t=this.getItem(e);null!=t&&this.room.engine.startRoomItemMove(t)}},{key:"startRoomItemPlacement",value:function(e){var t=this;if(null!=e.baseItem){var n=null;if(e.itemType===a.FloorItem){var i=this.room.engine.globalToTile(this.room.engine.lastMousePositionX,this.room.engine.lastMousePositionY);n=this.addFloorItemToRoom(e.id,i.x,i.y,0,e.baseItem.getUIViewDirection(),e.state,e.baseId)}else{var r=this.room.engine.globalToLocal(this.room.engine.lastMousePositionX,this.room.engine.lastMousePositionY);n=this.addWallItemToRoom(e.id,r.x,r.y,e.baseItem.getUIViewDirection(),e.state,e.baseId)}n.then((function(n){t.currentPlacingItem=n,t.startRoomItemMovement(e.id)}))}}},{key:"cancelRoomItemMovement",value:function(e){e===this.currentPlacingItem&&(this.removeItemFromRoom(e.id,!0),this.currentPlacingItem=void 0,qn.getGame().uiManager.doOpenInventory())}},{key:"finishRoomItemMovement",value:function(e){e===this.currentPlacingItem?(this.removeItemFromRoom(e.id,!0),qn.getGame().communicationManager.sendMessage(new Qe(e.id,e._x,e._y,e.rot)),qn.getGame().uiManager.doOpenInventory()):qn.getGame().communicationManager.sendMessage(new fe(e.id,e._x,e._y,e.rot))}},{key:"addFloorItemToRoom",value:function(e,t,n,a,i,r,o){var s=this,l=this.getItem(e);null!=l&&this.removeItemFromRoom(e,!1);var c=new pe(e,t,n,a,i,r,o,this.room);return null!=this.currentPlacingItem&&this.currentPlacingItem.id===e&&(qn.getGame().inventory.tryPlaceBaseItem(o),this.currentPlacingItem=void 0),this.room.engine.addRoomItemContainerSet(e,c.containers),this.items[e]=c,c.loadBase().then((function(t){return s.room.engine.removeRoomItemContainerSet(e),s.room.engine.addRoomItemContainerSet(e,t.containers),s.room.engine.addSelectableContainer(c.colorId,t.selectableContainers,c),null!=l&&l.showItemInfo(!0),c}))}},{key:"addWallItemToRoom",value:function(e,t,n,a,i,r){var o=this,s=this.getItem(e);null!=s&&this.removeItemFromRoom(e,!1);var l=new $e(e,t,n,a,i,r,this.room);return null!=this.currentPlacingItem&&this.currentPlacingItem.id===e&&(qn.getGame().inventory.tryPlaceBaseItem(r),this.currentPlacingItem=void 0),this.room.engine.addRoomItemContainerSet(e,l.containers),this.items[e]=l,l.loadBase().then((function(t){return o.room.engine.removeRoomItemContainerSet(e),o.room.engine.addRoomItemContainerSet(e,t.containers),o.room.engine.addSelectableContainer(l.colorId,t.selectableContainers,l),null!=s&&s.showItemInfo(!0),l}))}},{key:"itemSetState",value:function(e,t){var n=this.getItem(e);null!=n&&n.setState(t)}},{key:"removeItemFromRoom",value:function(e,t){this.room.engine.removeRoomItemContainerSet(e);var n=this.getItem(e);null!=n&&(this.room.engine.removeSelectableContainer(n.colorId),t&&qn.getGame().uiManager.onCloseSelectFurni(e),delete this.items[e])}},{key:"tick",value:function(e){for(var t in this.items)null!=this.items[t]&&this.items[t].tick(e)}}]),e}(),tt=function(){function e(t,n,a){Object(s.a)(this,e),this.message=void 0,this.roomUser=void 0,this.sprite=void 0,this.deltaY=void 0,this.targetY=void 0,this.message=t,this.roomUser=n,this.sprite=a,this.deltaY=a.y,this.targetY=a.y}return Object(l.a)(e,[{key:"move",value:function(e){e/=1e3,this.targetY<this.deltaY&&(this.deltaY-=nt*e,this.deltaY<this.targetY&&(this.deltaY=this.targetY),this.updateSpritePosition())}},{key:"updateSpritePosition",value:function(){this.sprite.y=this.deltaY}}]),e}(),nt=92,at=function(){function e(t){Object(s.a)(this,e),this.chats=void 0,this.room=void 0,this.container=void 0,this._chatRollerCounter=void 0,this._needsRoll=void 0,this.chats=[],this.room=t,this.container=new d.d,this._chatRollerCounter=0,this._needsRoll=!1}return Object(l.a)(e,[{key:"rollChats",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=this.chats[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.targetY-=23*e}}catch(o){n=!0,a=o}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}this._chatRollerCounter=0,this._needsRoll=!1}},{key:"addChat",value:function(e,t){var n=this.room.roomUserManager.getUser(e);if(null!=n){var a=qn.getGame().chatImager.generateChatBubble(0,n.user.name,t,n.avatarContainer.color,n.avatarContainer.headImage),i=new d.g(qn.getGame().engine.getTextureFromImage(a));i.interactive=!0,i.on("click",(function(){n.handleClick(0)})),i.on("tap",(function(){n.handleClick(0)})),i.cursor="pointer",n.speak(1.5),i.x=Math.floor(n.getSpriteX()-i.width/2),i.y=-100,this._needsRoll&&this.rollChats(1),this.chats.push(new tt(t,n,i)),this.container.addChild(i),this._needsRoll=!0}}},{key:"tick",value:function(e){this._chatRollerCounter+=e,this._chatRollerCounter>it&&(this.rollChats(Math.round(this._chatRollerCounter/it)),this._chatRollerCounter=0);var t=!0,n=!1,a=void 0;try{for(var i,r=this.chats[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.move(e)}}catch(o){n=!0,a=o}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}}]),e}(),it=5e3,rt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,w))).appendString(e),n}return Object(h.a)(t,e),t}(k),ot=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,_))}return Object(h.a)(t,e),t}(k),st=function(){function e(t){Object(s.a)(this,e),this.model=void 0,this.engine=void 0,this.roomUserManager=void 0,this.roomItemManager=void 0,this.chatManager=void 0,this.model=t,this.engine=new Ie(this),this.roomUserManager=new Ke(this),this.roomItemManager=new et(this),this.chatManager=new at(this),this.engine.setChatContainer(this.chatManager.container)}return Object(l.a)(e,[{key:"chat",value:function(e){qn.getGame().communicationManager.sendMessage(new rt(e))}},{key:"wave",value:function(){qn.getGame().communicationManager.sendMessage(new ot)}},{key:"tick",value:function(e){this.engine.tick(e),this.roomUserManager.tick(e),this.roomItemManager.tick(e),this.chatManager.tick(e)}},{key:"dispose",value:function(){this.engine.getStage().visible=!1,this.engine.getStage().removeChild()}}]),e}(),lt=function(e,t,n){var a=e.frames[n].frame,i=a.x,r=a.y,o=a.w,s=a.h,l=document.createElement("canvas");l.width=o,l.height=s;var c=l.getContext("2d");if(null!=c){l.width=o,l.height=s,c.drawImage(t,i,r,o,s,0,0,o,s);var u=new Image;return u.src=l.toDataURL(),u}return null},ct=function(){function e(t,n,a,i,r,o,l,c){Object(s.a)(this,e),this.lib=void 0,this.action=void 0,this.resAction=void 0,this.type=void 0,this.resType=void 0,this.isSmall=void 0,this.partId=void 0,this.direction=void 0,this.resDirection=void 0,this.resourceName=void 0,this.frame=void 0,this.resFrame=void 0,this.color=void 0,this.isFlip=void 0,this.promise=void 0,this.resource=void 0,this.resDirection=o,"hd"===a&&i&&(r=1),"ey"===a&&"std"===n&&1===r&&3===o&&(n="sml"),"fa"!==a||"std"!==n||2!==r||2!==o&&4!==o||(this.resDirection=1),"he"===a&&"std"===n&&1===r&&2===o&&(this.resDirection=0),"he"===a&&"std"===n&&8===r&&(this.resDirection=o%2===0?1:this.resDirection),"he"===a&&"std"===n&&(2131===r||2132===r)&&o>=2&&o<=6&&(this.resDirection=1),"ha"===a&&"std"===n&&2518===r&&(this.resDirection=o%2===0?2:1),"ha"===a&&"std"===n&&2519===r&&(this.resDirection=o%2===0?2:3),"ha"===a&&"std"===n&&2588===r&&(this.resDirection=7),"ha"===a&&"std"===n&&2589===r&&(this.resDirection=3),this.lib=t,this.isFlip=!1,this.action=n,this.resAction=n,this.type=a,this.resType=a,this.isSmall=i,this.partId=r,this.direction=o,this.frame=l,this.resFrame=l,this.color=c,this.resourceName=this.getResourceName(),this.promise=null,this.resource=null}return Object(l.a)(e,[{key:"getResourceName",value:function(){var e=this.isSmall?"sh":"h";return e+="_",e+=this.resAction,e+="_",e+=this.resType,e+="_",e+=this.partId,e+="_",e+=this.resDirection,e+="_",e+=this.resFrame}},{key:"extractFromAtlas",value:function(e,t){var n=lt(e,t,this.lib+"_"+this.getResourceName()+".png");return null!=n&&(this.resource=n,this.promise=Promise.resolve(n)),this.promise}},{key:"downloadAsync",value:function(e){var t=this;if(null==this.promise){var n=new Image;this.promise=new Promise((function(e,a){n.onload=function(){t.resource=n,e(n)},n.onerror=function(){a("Could not load image: "+n.src)}})),n.crossOrigin="anonymous",n.src=e+this.lib+"/"+this.lib+"_"+this.getResourceName()+".png"}return this.promise}}]),e}(),ut=function(){function e(t){Object(s.a)(this,e),this.ready=void 0,this.offsets=void 0,this.chunks=void 0,this.figuremap=void 0,this.figuredata=void 0,this.partsets=void 0,this.draworder=void 0,this.animation=void 0,this.resourcesUrl=void 0,this.ready=!1,this.offsets={},this.chunks={},this.figuremap={},this.figuredata={},this.partsets={},this.draworder={},this.animation={},this.resourcesUrl=t}return Object(l.a)(e,[{key:"initialize",value:function(){var e=this,t=this.loadFiles();return Promise.all(t).then((function(){e.ready=!0}))}},{key:"loadFiles",value:function(){var e=this;return[this.fetchJsonAsync(this.resourcesUrl+"map.json").then((function(t){e.figuremap=t})),this.fetchJsonAsync(this.resourcesUrl+"figuredata.json").then((function(t){e.figuredata=t})),this.fetchJsonAsync(this.resourcesUrl+"partsets.json").then((function(t){e.partsets=t})),this.fetchJsonAsync(this.resourcesUrl+"draworder.json").then((function(t){e.draworder=t})),this.fetchJsonAsync(this.resourcesUrl+"animation.json").then((function(t){e.animation=t}))]}},{key:"fetchJsonAsync",value:function(e){return new Promise((function(t,n){fetch(e,{method:"GET",mode:"cors",cache:"default"}).then((function(e){return e.json()})).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))}},{key:"downloadAtlasAsync",value:function(e){var t=new Image,n=new Promise((function(e,n){t.onload=function(){e(t)},t.onerror=function(){n("Could not load image: "+t.src)}}));return t.crossOrigin="anonymous",t.src=this.resourcesUrl+e+"/atlas.png",n}},{key:"fetchOffsetAsync",value:function(e){var t=this,n=this.fetchJsonAsync(this.resourcesUrl+e+"/offset.json").then((function(n){t.offsets[e].data=n})),a=this.downloadAtlasAsync(e).then((function(n){t.offsets[e].atlas=n}));return Promise.all([n,a])}},{key:"getTypeColorId",value:function(e,t){var n=new De(e,0,0,["std"],"std",0,!1,!1,"d"),a=0,i=!0,r=!1,o=void 0;try{for(var s,l=n.figure[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if(c.type===t){var u=this.getPartColor(c);for(var h in u){var d=u[h],m=!0,g=!1,v=void 0;try{for(var f,p=d[Symbol.iterator]();!(m=(f=p.next()).done);m=!0){var b=f.value;if(null!=b.color)return a=parseInt(b.color,16)}}catch(y){g=!0,v=y}finally{try{m||null==p.return||p.return()}finally{if(g)throw v}}}}}}catch(y){r=!0,o=y}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return a}},{key:"getChatColor",value:function(e){return this.getTypeColorId(e,"ch")}},{key:"generateGeneric",value:function(e,t){var n=this,a={};a.rect=this.getActivePartSet(e.isHeadOnly?"head":"figure"),a.head=this.getActivePartSet("head"),a.eye=this.getActivePartSet("eye"),a.gesture=this.getActivePartSet("gesture"),a.speak=this.getActivePartSet("speak"),a.walk=this.getActivePartSet("walk"),a.sit=this.getActivePartSet("sit"),a.itemRight=this.getActivePartSet("itemRight"),a.handRight=this.getActivePartSet("handRight"),a.handLeft=this.getActivePartSet("handLeft"),a.swim=this.getActivePartSet("swim");var i=this.getDrawOrder(e.drawOrder,e.direction);null==i&&(i=this.getDrawOrder("std",e.direction));var r={},o=!0,s=!1,l=void 0;try{for(var c,u=e.figure[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value,d=this.getPartColor(h);for(var m in d)null==r[m]&&(r[m]=[]),r[m]=d[m].concat(r[m])}}catch(F){s=!0,l=F}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}e.handItem>0&&(r.ri=[{index:0,id:e.handItem}]);var g=[],v=[],f=!0,p=!1,b=void 0;try{for(var y,I=i[Symbol.iterator]();!(f=(y=I.next()).done);f=!0){var k=y.value,x=r[k];if(null!=x){var C=!0,S=!1,w=void 0;try{for(var E,_=x[Symbol.iterator]();!(C=(E=_.next()).done);C=!0){var M=E.value,O=this.getPartUniqueName(k,M.id);if(null!=O){if(r.hidden.includes(k))continue;if(a.head.includes(k)&&e.isBodyOnly)continue;if(!a.rect.includes(k))continue;if(t&&(a.gesture.includes(k)||a.eye.includes(k)))continue;var R=e.direction,T=null;if(a.rect.includes(k)&&(T=e.drawAction.body),a.head.includes(k)&&(R=e.headDirection),a.speak.includes(k)&&e.drawAction.speak&&(T=e.drawAction.speak),a.gesture.includes(k)&&e.drawAction.gesture&&(T=e.drawAction.gesture),a.eye.includes(k)&&(M.colorable=!1,e.drawAction.eye&&(T=e.drawAction.eye)),a.walk.includes(k)&&e.drawAction.wlk&&(T=e.drawAction.wlk),a.sit.includes(k)&&e.drawAction.sit&&(T=e.drawAction.sit),a.handRight.includes(k)&&e.drawAction.handRight&&(T=e.drawAction.handRight),a.itemRight.includes(k)&&e.drawAction.itemRight&&(T=e.drawAction.itemRight),a.handLeft.includes(k)&&e.drawAction.handLeft&&(T=e.drawAction.handLeft),a.swim.includes(k)&&e.drawAction.swm&&(T=e.drawAction.swm),null==T)continue;null==this.offsets[O]&&(this.offsets[O]={promise:this.fetchOffsetAsync(O),data:{},atlas:{}}),v.push(this.offsets[O].promise);var j=M.colorable?M.color:null,N=this.getPartResource(O,T,k,e.isSmall,M.id,R,e.frame,j);g.push(N)}}}catch(F){S=!0,w=F}finally{try{C||null==_.return||_.return()}finally{if(S)throw w}}}}}catch(F){p=!0,b=F}finally{try{f||null==I.return||I.return()}finally{if(p)throw b}}return new Promise((function(a,i){Promise.all(v).then((function(){var r=document.createElement("canvas"),o=r.getContext("2d");r.width=e.rectWidth,r.height=e.rectHeight;var s=[],l=!0,c=!1,u=void 0;try{for(var h,d=g[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=h.value;if(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped){var v=n.partsets.partSet[m.type]["flipped-set-type"];if(""!==v&&(m.resType=v),"std"!==m.action||null!=n.offsets[m.lib].data&&null!=n.offsets[m.lib].data[m.getResourceName()]&&!n.offsets[m.lib].data[m.getResourceName()].flipped||(m.resAction="spk"),(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped)&&(m.isFlip=!0,m.resAction=m.action,m.resDirection=6-m.direction),(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped)&&(m.resFrame=m.frame+1,m.isFlip=!1),(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped)&&(m.isFlip=!1,m.resFrame=m.frame,m.resAction=m.action,7===m.direction&&(m.resDirection=3),3===m.direction&&(m.resDirection=7)),(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped)&&(m.resFrame=m.frame+1,m.isFlip=!1),(null==n.offsets[m.lib].data||null==n.offsets[m.lib].data[m.getResourceName()]||n.offsets[m.lib].data[m.getResourceName()].flipped)&&(m.resAction=m.action,m.resType=v,m.resDirection=m.direction),"std"!==m.action||null!=n.offsets[m.lib].data&&null!=n.offsets[m.lib].data[m.getResourceName()]&&!n.offsets[m.lib].data[m.getResourceName()].flipped||(m.resAction="spk",m.resType=m.type),null!=n.offsets[m.lib].data&&null!=n.offsets[m.lib].data[m.getResourceName()]&&!n.offsets[m.lib].data[m.getResourceName()].flipped){var f=n.offsets[m.lib].data.atlas,p=n.offsets[m.lib].atlas;s.push(m.extractFromAtlas(f,p))}}else{var b=n.offsets[m.lib].data.atlas,y=n.offsets[m.lib].atlas;s.push(m.extractFromAtlas(b,y))}}}catch(F){c=!0,u=F}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}Promise.all(s).catch((function(e){i("Error downloading chunks")})).then((function(){var i=!0,s=!1,l=void 0;try{for(var c,u=g[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var h=c.value;if(null!=n.offsets[h.lib].data&&null!=n.offsets[h.lib].data[h.getResourceName()]&&null!=h.resource){var d=-n.offsets[h.lib].data[h.getResourceName()].x,m=e.rectHeight/2-n.offsets[h.lib].data[h.getResourceName()].y+e.rectHeight/2.5,v=h.resource;null!=h.color&&(v=n.tintSprite(v,h.color,t?170:255)),h.isFlip&&(d=-(d+v.width-e.rectWidth+1),v=n.flipImage(v)),null!=o&&o.drawImage(v,d,m)}}}catch(F){s=!0,l=F}finally{try{i||null==u.return||u.return()}finally{if(s)throw l}}e.isDownsampled&&(r=n.downsampleImage(r)),a(r)}))}))}))}},{key:"getActivePartSet",value:function(e){var t=this.partsets.activePartSet[e].activePart;return null==t||0===t.length?null:t}},{key:"getDrawOrder",value:function(e,t){var n=this.draworder[e][t];return null==n||0===n.length?null:n}},{key:"getPartPalette",value:function(e){var t=this.figuredata.settype[e];if(null!=t){var n=t.paletteid;return this.figuredata.palette[n]}return null}},{key:"getPartPaletteCount",value:function(e,t){var n=this.getPartSet(e);if(null!=n){var a=n[t];if(null!=a){var i=a.part,r=Math.max.apply(Math,i.map((function(e){return e.colorindex})));return Math.max(1,r)}}return 1}},{key:"getPartSet",value:function(e){var t=this.figuredata.settype[e];return null!=t?t.set:null}},{key:"getPartColor",value:function(e){var t={},n=this.figuredata.settype[e.type];if(null!=n){if(null!=n.set[e.id]&&null!=n.set[e.id].part){var a=!0,i=!1,r=void 0;try{for(var o,s=n.set[e.id].part[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value,c={index:l.index,id:l.id,colorable:l.colorable};l.colorable&&(c.color=this.getColorByPaletteId(n.paletteid,e.colors[l.colorindex-1])),null==t[l.type]?t[l.type]=[c]:t[l.type].push(c)}}catch(f){i=!0,r=f}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}if(t.hidden=[],null!=n.set[e.id]&&Array.isArray(n.set[e.id].hidden)){var u=!0,h=!1,d=void 0;try{for(var m,g=n.set[e.id].hidden[Symbol.iterator]();!(u=(m=g.next()).done);u=!0){var v=m.value;t.hidden.push(v)}}catch(f){h=!0,d=f}finally{try{u||null==g.return||g.return()}finally{if(h)throw d}}}}return t}},{key:"getColorByPaletteId",value:function(e,t){return null!=this.figuredata.palette[e]&&null!=this.figuredata.palette[e][t]&&null!=this.figuredata.palette[e][t].color?this.figuredata.palette[e][t].color:null}},{key:"getPartUniqueName",value:function(e,t){var n=this.figuremap[e][t];return null==n&&"hrb"===e&&(n=this.figuremap.hr[t]),null==n&&(n=this.figuremap[e][1]),null==n&&(n=this.figuremap[e][0]),n}},{key:"getPartResource",value:function(e,t,n,a,i,r,o,s){var l=this.getFrameNumber(n,t,o),c=new ct(e,t,n,a,i,r,l,s),u=c.getResourceName();return null!=this.chunks[u]&&null!=this.chunks[u].resource?(c.resource=this.chunks[u].resource,c.promise=this.chunks[u].promise):this.chunks[u]=c,c}},{key:"getFrameNumber",value:function(e,t,n){var a={wav:"Wave",wlk:"Move",spk:"Talk"};if(null!=a[t]&&null!=this.animation[a[t]].part[e]){var i=this.animation[a[t]].part[e].length;if(null!=this.animation[a[t]].part[e][n%i])return this.animation[a[t]].part[e][n%i].number}return 0}},{key:"tintSprite",value:function(e,t,n){var a=document.createElement("canvas"),i=a.getContext("2d");if(null==i)return null;var r=this.hex2rgb(t),o=e.width,s=e.height;a.width=o,a.height=s,i.drawImage(e,0,0);for(var l=i.getImageData(0,0,o,s),c=0;c<s;c++)for(var u=c*o*4,h=0;h<o;h++){u++,u++,u++,0!==l.data[u++]&&(l.data[u-1]=n,l.data[u-2]=Math.round(r.b*l.data[u-2]/255),l.data[u-3]=Math.round(r.g*l.data[u-3]/255),l.data[u-4]=Math.round(r.r*l.data[u-4]/255))}return i.putImageData(l,0,0),a}},{key:"hex2rgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"flipImage",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(null==n)return null;var a=e.width,i=e.height;return t.width=a,t.height=i,n.save(),n.scale(-1,1),n.drawImage(e,0,0,-1*a,i),n.restore(),t}},{key:"downsampleImage",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(null==n)return null;var a=e.width,i=e.height;return t.width=a,t.height=i,n.save(),n.scale(.5,.5),n.drawImage(e,0,0),n.restore(),t}}]),e}(),ht=function(){function e(t){for(var n in Object(s.a)(this,e),this.furniBase=void 0,this.textures=void 0,this.solidTextures=void 0,this.infoImage=void 0,this.iconImage=void 0,this.iconTexture=void 0,this.furniBase=t,this.textures={},this.solidTextures={},this.furniBase.assets){var a=this.furniBase.assets[n];this._loadTexture(a.image,n)}this.infoImage=this.furniBase.draw(this.getUIViewDirection(),0,0),this.iconImage=this.furniBase.drawIcon(),this.iconTexture=qn.getGame().engine.getTextureFromImage(this.iconImage)}return Object(l.a)(e,[{key:"calculateNextDirection",value:function(e){var t=this.furniBase.getAvailableDirections(),n=t.indexOf(e);return t[(n+1)%t.length]}},{key:"getUIViewDirection",value:function(){var e=this.furniBase.getAvailableDirections();return e.includes(4)?4:e.includes(2)?2:e[0]}},{key:"getTexture",value:function(e){return null!=this.textures[e]?this.textures[e]:null}},{key:"getSolidTexture",value:function(e){return null!=this.solidTextures[e]?this.solidTextures[e]:null}},{key:"_loadTexture",value:function(e,t){this.textures[t]=qn.getGame().engine.getTextureFromImage(e),this._loadSolidTexture(e,t)}},{key:"_loadSolidTexture",value:function(e,t){this.solidTextures[t]=qn.getGame().engine.getTextureFromImage(Be(e,255,255,255))}}]),e}(),dt=function(){function e(t){Object(s.a)(this,e),this.furniImager=void 0,this.items=void 0,this.furniImager=t,this.items={}}return Object(l.a)(e,[{key:"getItem",value:function(e,t){return null==this.items[t]&&(this.items[t]=new Promise((function(n,a){qn.getGame().furniImager.loadItemBase(e,t,64).then((function(e){var t=new ht(e);n(t)})).catch((function(e){return a(e)}))}))),this.items[t]}}]),e}(),mt=function(){function e(t){Object(s.a)(this,e),this.connected=void 0,this.ws=void 0,this.messageHandler=void 0,this.connected=!1,this.messageHandler=t}return Object(l.a)(e,[{key:"send",value:function(e){this.connected&&null!=this.ws&&this.ws.send(e)}},{key:"connect",value:function(e){var t=this;return new Promise((function(n,a){t.ws=new WebSocket(e),t.ws.onopen=function(e){t.connected=!0,t.messageHandler.handleOpenConnection(),n()},t.ws.onclose=function(e){t.connected=!1,t.messageHandler.handleCloseConnection()},t.ws.onmessage=function(e){t.messageHandler.handleMessage(e.data)},t.ws.onerror=function(e){t.connected||a("Cannot connect to host"),t.connected=!1,t.messageHandler.handleConnectionError()}}))}}]),e}(),gt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=e.popString(),a=e.popString(),i=e.popString();qn.getGame().handleUserData(t,n,a,i)}}]),e}(),vt=function(){function e(t){Object(s.a)(this,e),this.pointer=void 0,this.id=void 0,this.tokens=void 0,this.pointer=0,this.tokens=t.split(ft),this.id=this.popInt()}return Object(l.a)(e,[{key:"popToken",value:function(){return this.tokens.length>this.pointer?this.tokens[this.pointer++]:""}},{key:"popInt",value:function(){return parseInt(this.popToken())}},{key:"popFloat",value:function(){return parseFloat(this.popToken())}},{key:"popString",value:function(){for(var e=this.popInt(),t=this.popToken(),n=0;n<e;n++)t+=ft+this.popToken();return t}},{key:"popBoolean",value:function(){return 1===this.popInt()}}]),e}(),ft="|",pt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=0;n<t;n++){var a=e.popInt(),i=e.popInt(),r=e.popInt(),o=e.popFloat(),s=e.popInt(),l=e.popInt(),c=e.popInt(),u=qn.getGame().currentRoom;null!=u&&u.roomItemManager.addFloorItemToRoom(a,i,r,o,s,c,l)}}}]),e}(),bt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=0;n<t;n++){var a=e.popInt(),i=e.popInt(),r=e.popInt(),o=e.popFloat(),s=e.popInt(),l=e.popString(),c=e.popString(),u=e.popString(),h=qn.getGame().currentRoom;null!=h&&h.roomUserManager.addUserToRoom(a,i,r,o,s,l,c,u)}}}]),e}(),yt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=0;n<t;n++){for(var a=e.popInt(),i=e.popInt(),r=e.popInt(),o=e.popFloat(),s=e.popInt(),l=e.popInt(),c={},u=0;u<l;u++){var h=e.popString(),d=e.popString();c[h]=d}var m=qn.getGame().currentRoom;null!=m&&m.roomUserManager.updateUserStatus(a,i,r,o,s,c)}}}]),e}(),It=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=qn.getGame().currentRoom;null!=n&&n.roomUserManager.removeUserFromRoom(t,!0)}}]),e}(),kt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=e.popString(),a=qn.getGame().currentRoom;null!=a&&a.chatManager.addChat(t,n)}}]),e}(),xt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=qn.getGame().currentRoom;null!=n&&n.roomUserManager.userWave(t)}}]),e}(),Ct=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=qn.getGame().currentRoom;null!=n&&n.roomItemManager.removeItemFromRoom(t,!0)}}]),e}(),St=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=e.popInt(),a=qn.getGame().currentRoom;null!=a&&a.roomItemManager.itemSetState(t,n)}}]),e}(),wt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=0;n<t;n++){var a=e.popInt(),i=e.popInt(),r=e.popInt(),o=e.popInt(),s=e.popInt(),l=e.popInt(),c=qn.getGame().currentRoom;null!=c&&c.roomItemManager.addWallItemToRoom(a,i,r,o,l,s)}}}]),e}(),Et=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=0;n<t;n++){var i=e.popInt(),r="F"===e.popString()?a.FloorItem:a.WallItem,o=e.popInt(),s=e.popInt(),l=e.popBoolean();qn.getGame().inventory.addItem(i,o,s,l,r)}}}]),e}(),_t=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt();qn.getGame().inventory.removeItem(t)}}]),e}(),Mt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=[],a=0;a<t;a++)n.push(this.extractPage(e));qn.getGame().catalogue.setIndex(n)}},{key:"extractPage",value:function(e){for(var t=e.popBoolean(),n=e.popInt(),a=e.popInt(),i=e.popInt(),r=e.popString(),o=e.popInt(),s=[],l=0;l<o;l++)s.push(this.extractPage(e));return{id:i,name:r,iconId:a,color:n,visible:t,children:s}}}]),e}(),Ot=function(){function e(t,n,a,i,r,o){Object(s.a)(this,e),this.itemId=void 0,this.itemName=void 0,this.cost=void 0,this.itemType=void 0,this.baseId=void 0,this.baseItem=void 0,this.amount=void 0,this.itemId=t,this.itemName=n,this.cost=a,this.itemType=i,this.baseId=r,this.amount=o,this.baseItem=null}return Object(l.a)(e,[{key:"loadBase",value:function(){var e=this;return qn.getGame().baseItemManager.getItem(this.itemType,this.baseId).then((function(t){return e.baseItem=t,t}))}}]),e}(),Rt=function e(t,n,a,i,r,o,l,c,u){Object(s.a)(this,e),this.id=void 0,this.layout=void 0,this.imageHeadline=void 0,this.imageTeaser=void 0,this.textHeader=void 0,this.textDetails=void 0,this.textMisc=void 0,this.textMisc2=void 0,this.items=void 0,this.id=t,this.layout=n,this.imageHeadline=a,this.imageTeaser=i,this.textHeader=r,this.textDetails=o,this.textMisc=l,this.textMisc2=c,this.items=u},Tt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=e.popString(),i=e.popString(),r=e.popString(),o=e.popString(),s=e.popString(),l=e.popString(),c=e.popString(),u=e.popInt(),h=[],d=0;d<u;d++){var m=e.popInt(),g=e.popString(),v=e.popInt(),f="F"===e.popString()?a.FloorItem:a.WallItem,p=e.popInt(),b=e.popInt();h.push(new Ot(m,g,v,f,p,b))}var y=new Rt(t,n,i,r,o,s,l,c,h);qn.getGame().catalogue.setCataloguePage(y)}}]),e}(),jt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){e.popBoolean()&&qn.getGame().uiManager.onShowNotification("Not enough credits")}}]),e}(),Nt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){}}]),e}(),Ft=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt();qn.getGame().userManager.updateCreditsBalance(t)}}]),e}(),Pt=function(){function e(t,n,a,i,r){Object(s.a)(this,e),this.maxX=void 0,this.maxY=void 0,this.doorX=void 0,this.doorY=void 0,this.heightMap=void 0,this.maxX=t,this.maxY=n,this.doorX=a,this.doorY=i,this.heightMap=r}return Object(l.a)(e,[{key:"isValidTile",value:function(e,t){return e>=0&&e<this.maxX&&t>=0&&t<this.maxY&&0!==this.heightMap[e][t]}}]),e}(),Gt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=e.popInt(),a=e.popInt(),i=e.popInt(),r=[],o=0;o<t;o++){r.push([]);for(var s=0;s<n;s++)r[o].push(e.popInt())}var l=new Pt(t,n,a,i,r);qn.getGame().handleHeightMap(l)}}]),e}(),At=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popString(),n=e.popInt();qn.getGame().handleRoomModelInfo(t,n)}}]),e}();!function(e){e[e.Open=0]="Open",e[e.Locked=1]="Locked",e[e.Password=2]="Password"}(de||(de={}));var Ut,qt=function e(t,n,a,i,r,o,l,c){Object(s.a)(this,e),this.id=void 0,this.name=void 0,this.owner=void 0,this.description=void 0,this.capacity=void 0,this.userCount=void 0,this.isFavourite=void 0,this.lockType=void 0,this.id=t,this.name=n,this.owner=a,this.description=i,this.capacity=r,this.userCount=o,this.isFavourite=l,this.lockType=c},Lt=function(e){var t=e.popInt(),n=e.popString(),a=e.popString(),i=e.popString(),r=e.popInt(),o=e.popInt(),s=e.popInt(),l=de.Open;return 1===r?l=de.Locked:2===r&&(l=de.Password),new qt(t,n,a,i,s,o,!1,l)},Dt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=Lt(e);qn.getGame().navigator.handleCurrentRoomData(t)}}]),e}(),zt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=[],a=0;a<t;a++){var i=Lt(e);n.push(i)}qn.getGame().navigator.handleRoomDataList(n)}}]),e}(),Ht=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){qn.getGame().unloadRoom()}}]),e}(),Bt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=[],a=[],i=0;i<t;i++){var r=e.popInt(),o=e.popString(),s=e.popString(),l=e.popString(),c=e.popBoolean(),u=qn.getGame().userManager.setUser(r,o,l,s);c?n.push(u):a.push(u)}qn.getGame().messenger.handleFriends(n,a)}}]),e}(),Wt=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,J))).appendInt(e),a.appendString(n),a}return Object(h.a)(t,e),t}(k),Zt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,X))).appendInt(e),n}return Object(h.a)(t,e),t}(k),Yt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,K))).appendInt(e),n}return Object(h.a)(t,e),t}(k),Xt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,Z))).appendInt(e),n}return Object(h.a)(t,e),t}(k),Vt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,Y))).appendInt(e),n}return Object(h.a)(t,e),t}(k),Jt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,V))).appendString(e),n}return Object(h.a)(t,e),t}(k),Kt=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,$))).appendInt(e),n}return Object(h.a)(t,e),t}(k);!function(e){e[e.Me=0]="Me",e[e.Friend=1]="Friend",e[e.Info=2]="Info"}(Ut||(Ut={}));var $t=function(){function e(){Object(s.a)(this,e),this.activeChats=void 0,this.onlineFriends=void 0,this.offlineFriends=void 0,this.activeChats={},this.onlineFriends=[],this.offlineFriends=[]}return Object(l.a)(e,[{key:"requestStartChat",value:function(e){var t=qn.getGame().userManager.getUser(e);null!=t&&(this._tryInitializeChat(t),qn.getGame().uiManager.onOpenMessengerChat(this.activeChats[e]))}},{key:"getActiveChat",value:function(e){var t=qn.getGame().userManager.getUser(e);return null!=t?(this._tryInitializeChat(t),this.activeChats[e]):null}},{key:"handleFriends",value:function(e,t){this.onlineFriends=e,this.offlineFriends=t,this.notifyUiFriendsUpdate()}},{key:"handleFriendsSearch",value:function(e){}},{key:"handleFriendRequests",value:function(e){}},{key:"notifyUiFriendsUpdate",value:function(){qn.getGame().uiManager.onSetFriends(this.onlineFriends,this.offlineFriends)}},{key:"handleUpdateFriend",value:function(e,t){this.offlineFriends=this.offlineFriends.filter((function(t){return t.id!==e.id})),this.onlineFriends=this.onlineFriends.filter((function(t){return t.id!==e.id})),t?this.onlineFriends.push(e):this.offlineFriends.push(e),this.notifyUiFriendsUpdate(),null!=this.activeChats[e.id]&&(t?this.handleMessengerMessage(e.id,"Your friend went online.",Ut.Info):this.handleMessengerMessage(e.id,"Your friend went offline.",Ut.Info))}},{key:"_tryInitializeChat",value:function(e){null==this.activeChats[e.id]&&(this.activeChats[e.id]={user:e,chats:[]})}},{key:"getCurrentTime",value:function(){return(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}},{key:"handleMessengerMessage",value:function(e,t,n){var a=qn.getGame().userManager.getUser(e);if(null!=a){this._tryInitializeChat(a),n!==Ut.Info&&(t=this.getCurrentTime()+": "+t);var i={text:t,type:n};this.activeChats[e].chats.push(i),qn.getGame().uiManager.onReceiveMessengerMessage(this.activeChats[e])||n!==Ut.Friend||(qn.getGame().soundManager.playConsoleReceiveSound(),qn.getGame().uiManager.onShowMessengerAlert())}}},{key:"sendChatMessage",value:function(e,t){var n=this.activeChats[e];null!=n&&0===n.chats.length&&qn.getGame().soundManager.playConsoleSentSound(),qn.getGame().communicationManager.sendMessage(new Wt(e,t))}},{key:"requestFollowFriend",value:function(e){qn.getGame().communicationManager.sendMessage(new Zt(e))}},{key:"requestAddFriend",value:function(e){qn.getGame().communicationManager.sendMessage(new Kt(e))}},{key:"requestRemoveFriend",value:function(e){qn.getGame().communicationManager.sendMessage(new Yt(e))}},{key:"requestFriendSearch",value:function(e){qn.getGame().communicationManager.sendMessage(new Jt(e))}},{key:"acceptFriendRequest",value:function(e){qn.getGame().communicationManager.sendMessage(new Xt(e))}},{key:"denyFriendRequest",value:function(e){qn.getGame().communicationManager.sendMessage(new Vt(e))}}]),e}(),Qt=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=e.popString(),a=e.popBoolean();qn.getGame().messenger.handleMessengerMessage(t,n,a?Ut.Me:Ut.Friend)}}]),e}(),en=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=[],a=0;a<t;a++){var i=e.popInt(),r=e.popString(),o=e.popString(),s=e.popString();e.popBoolean();var l=qn.getGame().userManager.setUser(i,r,s,o);n.push(l)}qn.getGame().messenger.handleFriendRequests(n)}}]),e}(),tn=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){for(var t=e.popInt(),n=[],a=0;a<t;a++){var i=e.popInt(),r=e.popString(),o=e.popString(),s=e.popString();e.popBoolean();var l=qn.getGame().userManager.setUser(i,r,s,o);n.push(l)}qn.getGame().messenger.handleFriendsSearch(n)}}]),e}(),nn=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"handle",value:function(e){var t=e.popInt(),n=e.popString(),a=e.popString(),i=e.popString(),r=e.popBoolean(),o=qn.getGame().userManager.setUser(t,n,i,a);qn.getGame().messenger.handleUpdateFriend(o,r)}}]),e}(),an=function(){function e(){var t=this;Object(s.a)(this,e),this.client=void 0,this.requestHandlers=void 0,this.handleMessage=function(e){var n=new vt(e),a=t.requestHandlers[n.id];null==a||a.handle(n)},this.handleOpenConnection=function(){qn.getGame().uiManager.log("Connected!!1")},this.handleCloseConnection=function(){qn.getGame().stop()},this.handleConnectionError=function(){},this.client=new mt(this),this.requestHandlers={},this._registerRequests()}return Object(l.a)(e,[{key:"_registerRequests",value:function(){this.requestHandlers[3]=new gt,this.requestHandlers[4]=new Gt,this.requestHandlers[6]=new bt,this.requestHandlers[8]=new yt,this.requestHandlers[11]=new It,this.requestHandlers[10]=new kt,this.requestHandlers[14]=new xt,this.requestHandlers[16]=new pt,this.requestHandlers[17]=new Ct,this.requestHandlers[19]=new St,this.requestHandlers[20]=new wt,this.requestHandlers[21]=new Et,this.requestHandlers[22]=new _t,this.requestHandlers[23]=new Mt,this.requestHandlers[24]=new Tt,this.requestHandlers[25]=new jt,this.requestHandlers[26]=new Nt,this.requestHandlers[27]=new Ft,this.requestHandlers[28]=new At,this.requestHandlers[29]=new Dt,this.requestHandlers[30]=new zt,this.requestHandlers[31]=new Ht,this.requestHandlers[32]=new Bt,this.requestHandlers[34]=new Qt,this.requestHandlers[35]=new en,this.requestHandlers[33]=new tn,this.requestHandlers[36]=new nn}},{key:"sendMessage",value:function(e){this.client.connected&&this.client.send(e.body)}},{key:"connect",value:function(e){return this.client.connect(e)}}]),e}(),rn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,M))}return Object(h.a)(t,e),t}(k),on=function e(t,n,a,i){Object(s.a)(this,e),this.base=void 0,this.pointer=void 0,this.color=void 0,this.regPoints=void 0,this.regPoints=t,this.base=n,this.pointer=a,this.color=i},sn=function(){function e(){Object(s.a)(this,e),this.chatStyles=void 0,this.chatStyles={}}return Object(l.a)(e,[{key:"initialize",value:function(){var e=this;return this._downloadChatStyle("assets/normal_chat/regpoints.json","assets/normal_chat/style_normal_chat_bubble_base.png","assets/normal_chat/style_normal_chat_bubble_pointer.png","assets/normal_chat/style_normal_chat_bubble_color.png").then((function(t){e.chatStyles[0]=t}))}},{key:"_downloadChatStyle",value:function(e,t,n,a){var i=this;return this._fetchJsonAsync(e).then((function(e){return i._downloadImageAsync(t).then((function(t){return i._downloadImageAsync(n).then((function(n){return i._downloadImageAsync(a).then((function(a){return new on(e,t,n,a)}))}))}))}))}},{key:"_fetchJsonAsync",value:function(e){return new Promise((function(t,n){fetch(e,{method:"GET",mode:"cors",cache:"default"}).then((function(e){return e.json()})).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))}},{key:"_downloadImageAsync",value:function(e){var t=new Image,n=new Promise((function(e,n){t.onload=function(){e(t)},t.onerror=function(){n("Could not load image: "+t.src)}}));return t.crossOrigin="anonymous",t.src=e,n}},{key:"_getStyle",value:function(e){var t=this.chatStyles[e];return null!=t?t:this.chatStyles[0]}},{key:"generateChatBubble",value:function(e,t,n,a,i){var r=this._getStyle(e),o=document.createElement("canvas"),s=o.getContext("2d"),l="400 13px Ubuntu";if(null!=s){s.font="600 13px Ubuntu",s.textBaseline="top",s.fillStyle="black";var c=Math.round(s.measureText(t+": ").width);s.font=l;var u=c+Math.round(s.measureText(n).width+5);o.width=32+u+5,o.height=r.base.height;for(var h=24;h<32+u;h++)s.drawImage(r.base,32,0,1,r.base.height,h,0,1,r.base.height);s.drawImage(r.base,r.base.width-5,0,5,r.base.height,32+u,0,5,r.base.height),s.textBaseline="top",s.fillStyle="black",s.font="600 13px Ubuntu",s.fillText(t+": ",32,6),s.font=l,s.fillText(n,32+c,6);var d=this._tintSprite(r.color,a);s.drawImage(d,0,0),s.drawImage(i,-3,-7)}return o}},{key:"_int2rgb",value:function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}},{key:"_tintSprite",value:function(e,t){var n=document.createElement("canvas"),a=n.getContext("2d");if(null==a)return e;var i=this._int2rgb(t),r=e.width,o=e.height;n.width=r,n.height=o,a.drawImage(e,0,0);for(var s=a.getImageData(0,0,r,o),l=0;l<o;l++)for(var c=l*r*4,u=0;u<r;u++){c++,c++,c++,0!==s.data[c++]&&(s.data[c-2]=Math.round(i.b*s.data[c-2]/255),s.data[c-3]=Math.round(i.g*s.data[c-3]/255),s.data[c-4]=Math.round(i.r*s.data[c-4]/255))}return a.putImageData(s,0,0),n}}]),e}(),ln=function(){function e(){Object(s.a)(this,e),this.baseImage=void 0,this.pointerImage=void 0}return Object(l.a)(e,[{key:"initialize",value:function(){var e=this;return Promise.all([this._downloadImageAsync("assets/memenu/base.png").then((function(t){e.baseImage=t})),this._downloadImageAsync("assets/memenu/pointer.png").then((function(t){e.pointerImage=t}))])}},{key:"_downloadImageAsync",value:function(e){var t=new Image,n=new Promise((function(e,n){t.onload=function(){e(t)},t.onerror=function(){n("Could not load image: "+t.src)}}));return t.crossOrigin="anonymous",t.src=e,n}},{key:"generateSign",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),a="400 12px Ubuntu";if(null!=n&&null!=this.baseImage&&null!=this.pointerImage){n.font=a,n.textBaseline="top",n.fillStyle="white";var i=Math.round(n.measureText(e).width);t.width=18+i+18,t.height=this.baseImage.height+this.pointerImage.height,n.drawImage(this.baseImage,0,0,18,this.baseImage.height,0,0,18,this.baseImage.height);for(var r=18;r<18+i;r++)n.drawImage(this.baseImage,32,0,1,this.baseImage.height,r,0,1,this.baseImage.height);n.drawImage(this.baseImage,this.baseImage.width-18,0,18,this.baseImage.height,18+i,0,18,this.baseImage.height),n.font=a,n.textBaseline="top",n.fillStyle="white",n.drawImage(this.pointerImage,Math.floor(i/2)+18-6,24),n.fillText(e,18,7)}return t}}]),e}(),cn=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,C))).appendString(e),a.appendString(n),a}return Object(h.a)(t,e),t}(k),un=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,j))).appendString(e),a.appendString(n),a}return Object(h.a)(t,e),t}(k),hn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,N))).appendString(e),n}return Object(h.a)(t,e),t}(k),dn=function(){function e(t){Object(s.a)(this,e),this.game=void 0,this.onSetUserData=void 0,this.onSelectFurni=void 0,this.onSelectUser=void 0,this.onCloseSelectFurni=void 0,this.onCloseSelectUser=void 0,this.onFocusChat=void 0,this.onLoadPost=void 0,this.onGameStop=void 0,this.onUpdateCreditsBalance=void 0,this.onShowNotification=void 0,this.onOpenChangeLooks=void 0,this.onCloseChangeLooks=void 0,this.onOpenInventory=void 0,this.onUpdateInventory=void 0,this.onCloseInventory=void 0,this.onOpenCatalogue=void 0,this.onLoadCataloguePage=void 0,this.onLoadCatalogueIndex=void 0,this.onCloseCatalogue=void 0,this.onOpenNavigator=void 0,this.onCloseNavigator=void 0,this.onLoadRoomList=void 0,this.onOpenCreateRoom=void 0,this.onCloseCreateRoom=void 0,this.onCurrentRoomDataLoad=void 0,this.onCloseRoomInfo=void 0,this.onOpenMessenger=void 0,this.onCloseMessenger=void 0,this.onCloseChat=void 0,this.onSetFriends=void 0,this.onSetFriendsSearch=void 0,this.onSetFriendRequests=void 0,this.onReceiveMessengerMessage=void 0,this.onOpenMessengerChat=void 0,this.onOpenChat=void 0,this.onShowMessengerAlert=void 0,this.game=t,this.onSetUserData=function(){},this.onSelectFurni=function(){},this.onSelectUser=function(){},this.onLoadPost=function(){},this.onFocusChat=function(){},this.onGameStop=function(){},this.onCloseSelectFurni=function(){},this.onCloseSelectUser=function(){},this.onOpenChangeLooks=function(){},this.onCloseChangeLooks=function(){},this.onOpenInventory=function(){},this.onUpdateInventory=function(){},this.onCloseInventory=function(){},this.onOpenCatalogue=function(){},this.onLoadCataloguePage=function(){},this.onCloseCatalogue=function(){},this.onLoadCatalogueIndex=function(){},this.onUpdateCreditsBalance=function(){},this.onShowNotification=function(){},this.onOpenNavigator=function(){},this.onCloseNavigator=function(){},this.onLoadRoomList=function(){},this.onCurrentRoomDataLoad=function(){},this.onOpenCreateRoom=function(){},this.onCloseCreateRoom=function(){},this.onOpenMessenger=function(){},this.onCloseMessenger=function(){},this.onCloseChat=function(){},this.onSetFriends=function(){},this.onSetFriendsSearch=function(){},this.onSetFriendRequests=function(){},this.onReceiveMessengerMessage=function(){return!1},this.onOpenChat=function(){},this.onOpenMessengerChat=function(){},this.onShowMessengerAlert=function(){},this.onCloseRoomInfo=function(){}}return Object(l.a)(e,[{key:"log",value:function(e){console.log("Log: "+e)}},{key:"postLoading",value:function(e){console.log("Loading: "+e),this.onLoadPost(e)}},{key:"doChat",value:function(e){var t=this.game.currentRoom;null!=t&&e.length>0&&t.chat(e)}},{key:"doLogin",value:function(e,t){this.game.communicationManager.sendMessage(new cn(e,t))}},{key:"doFurniInteract",value:function(e){var t=this.game.currentRoom;if(null!=t){var n=t.roomItemManager.getItem(e);null!=n&&n.handleDoubleClick(0)}}},{key:"doFurniPickUp",value:function(e){var t=this.game.currentRoom;if(null!=t){var n=t.roomItemManager.getItem(e);null!=n&&n.pickUp()}}},{key:"doFurniRotate",value:function(e){var t=this.game.currentRoom;if(null!=t){var n=t.roomItemManager.getItem(e);null!=n&&n.rotate()}}},{key:"doFurniMove",value:function(e){var t=this.game.currentRoom;null!=t&&t.roomItemManager.startRoomItemMovement(e)}},{key:"doFurniPlace",value:function(e){var t=this.game,n=t.currentRoom,a=t.inventory;null!=n&&a.tryPlaceItem(e)}},{key:"doWave",value:function(){var e=this.game.currentRoom;null!=e&&e.wave()}},{key:"doChangeLooks",value:function(e,t){null!=this.game.currentRoom&&this.game.communicationManager.sendMessage(new un(e,t))}},{key:"doOpenChangeLooks",value:function(){var e=this.game.userManager.currentUser;null!=e&&this.onOpenChangeLooks(e.look)}},{key:"doOpenInventory",value:function(){null!=this.game.userManager.currentUser&&(this.onOpenInventory(),this.game.inventory.updateInventory())}},{key:"doOpenCreateRoom",value:function(){null!=this.game.userManager.currentUser&&this.onOpenCreateRoom()}},{key:"doCloseCreateRoom",value:function(){null!=this.game.userManager.currentUser&&this.onCloseCreateRoom()}},{key:"doChangeMotto",value:function(e){null!=this.game.userManager.currentUser&&this.game.communicationManager.sendMessage(new hn(e))}},{key:"doOpenCatalogue",value:function(){null!=this.game.userManager.currentUser&&this.onOpenCatalogue()}},{key:"doOpenNavigator",value:function(){null!=this.game.userManager.currentUser&&this.onOpenNavigator()}},{key:"doRequestNavigatorSearch",value:function(e){null!=this.game.userManager.currentUser&&this.game.navigator.requestSearchRooms(e)}},{key:"doRequestNavigatorRooms",value:function(){null!=this.game.userManager.currentUser&&this.game.navigator.requestPopularRooms()}},{key:"doRequestNavigatorMyRooms",value:function(){null!=this.game.userManager.currentUser&&this.game.navigator.requestOwnRooms()}},{key:"doRequestGoToRoom",value:function(e){null!=this.game.userManager.currentUser&&this.game.navigator.requestGoToRoom(e)}},{key:"doRequestLeaveRoom",value:function(){null!=this.game.userManager.currentUser&&this.game.navigator.requestLeaveRoom()}},{key:"doRequestCreateRoom",value:function(e,t){null!=this.game.userManager.currentUser&&this.game.navigator.requestCreateRoom(e,t)}},{key:"doRequestCataloguePage",value:function(e){null!=this.game.userManager.currentUser&&this.game.catalogue.requestPage(e)}},{key:"doRequestCataloguePurchase",value:function(e,t){null!=this.game.userManager.currentUser&&this.game.catalogue.requestPurchase(e,t)}},{key:"doRequestOpenChat",value:function(){this.onOpenChat()}},{key:"doRequestOpenMessenger",value:function(e){this.onOpenMessenger()}},{key:"doRequestAskForFriend",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.requestAddFriend(e)}},{key:"doRequestDenyFriendRequest",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.denyFriendRequest(e)}},{key:"doRequestAcceptFriendRequest",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.acceptFriendRequest(e)}},{key:"doRequestFriendSearch",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.requestFriendSearch(e)}},{key:"doRequestRemoveFriend",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.requestRemoveFriend(e)}},{key:"doRequestFollowFriend",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.requestFollowFriend(e)}},{key:"doRequestStartChat",value:function(e){null!=this.game.userManager.currentUser&&qn.getGame().messenger.requestStartChat(e)}},{key:"doRequestSendChatMessage",value:function(e,t){null!=this.game.userManager.currentUser&&qn.getGame().messenger.sendChatMessage(e,t)}}]),e}(),mn=function e(t,n,a,i){Object(s.a)(this,e),this.id=void 0,this.name=void 0,this.motto=void 0,this.look=void 0,this.id=t,this.name=n,this.motto=a,this.look=i},gn=function(){function e(){Object(s.a)(this,e),this.users=void 0,this.currentUser=void 0,this.credits=void 0,this.clubDays=void 0,this.users={},this.credits=-1,this.clubDays=69}return Object(l.a)(e,[{key:"setUser",value:function(e,t,n,a){var i=this.getUser(e);return null==i?this.users[e]=new mn(e,t,n,a):(i.look=a,i.motto=n,i.name=t),this.users[e]}},{key:"getUser",value:function(e){return this.users[e]}},{key:"setCurrentUser",value:function(e,t,n,a){return this.currentUser=this.setUser(e,t,n,a),this.currentUser}},{key:"updateCreditsBalance",value:function(e){-1!==this.credits&&qn.getGame().soundManager.playCreditsSound(),this.credits=e,qn.getGame().uiManager.onUpdateCreditsBalance(e)}}]),e}(),vn=function(){function e(t,n,a,i,r){Object(s.a)(this,e),this.id=void 0,this.baseItem=void 0,this.baseId=void 0,this.state=void 0,this.stackable=void 0,this.itemType=void 0,this.id=t,this.baseId=n,this.state=a,this.stackable=i,this.itemType=r,this.baseItem=null}return Object(l.a)(e,[{key:"loadBase",value:function(){var e=this;return qn.getGame().baseItemManager.getItem(this.itemType,this.baseId).then((function(t){e.baseItem=t}))}}]),e}(),fn=function(){function e(){Object(s.a)(this,e),this.items=void 0,this.lastPlacedBaseItem=void 0,this.items={}}return Object(l.a)(e,[{key:"getItem",value:function(e){return e in this.items?this.items[e]:null}},{key:"addItem",value:function(e,t,n,a,i){var r=this;if(null==this.getItem(e)){var o=new vn(e,t,n,a,i);this.items[e]=o,this.updateInventory(),o.loadBase().then((function(){r.updateInventory()}))}}},{key:"removeItem",value:function(e){null!=this.getItem(e)&&(delete this.items[e],this.updateInventory())}},{key:"tryPlaceItem",value:function(e){var t=this.getItem(e),n=qn.getGame().currentRoom;null!=t&&null!=n&&null!=t.baseItem&&(qn.getGame().uiManager.onCloseInventory(),n.roomItemManager.startRoomItemPlacement(t),this.lastPlacedBaseItem=t.baseItem)}},{key:"findItemByBase",value:function(e){for(var t in this.items){var n=this.items[t];if(n.baseId===e)return n}return null}},{key:"tryPlaceBaseItem",value:function(e){var t=this.findItemByBase(e),n=qn.getGame().currentRoom;null!=t&&null!=n&&null!=t.baseItem&&(qn.getGame().uiManager.onCloseInventory(),n.roomItemManager.startRoomItemPlacement(t),this.lastPlacedBaseItem=t.baseItem)}},{key:"updateInventory",value:function(){qn.getGame().uiManager.onUpdateInventory(Object.values(this.items))}}]),e}(),pn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,F))}return Object(h.a)(t,e),t}(k),bn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,A))).appendInt(e),n}return Object(h.a)(t,e),t}(k),yn=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,U))).appendInt(e),a.appendInt(n),a}return Object(h.a)(t,e),t}(k),In=function(){function e(){Object(s.a)(this,e),this.catalogueIndex=void 0,this.pages=void 0,this.catalogueIndex=[],this.pages={}}return Object(l.a)(e,[{key:"setIndex",value:function(e){this.catalogueIndex=e,qn.getGame().uiManager.onLoadCatalogueIndex(e),e.length>0&&this.requestPage(e[0].id)}},{key:"setCataloguePage",value:function(e){this.pages[e.id]=e,qn.getGame().uiManager.onLoadCataloguePage(e)}},{key:"getPage",value:function(e){return this.pages[e]}},{key:"requestPage",value:function(e){var t=this.getPage(e);null==t?qn.getGame().communicationManager.sendMessage(new bn(e)):qn.getGame().uiManager.onLoadCataloguePage(t)}},{key:"requestPurchase",value:function(e,t){qn.getGame().communicationManager.sendMessage(new yn(e,t))}}]),e}(),kn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,G))}return Object(h.a)(t,e),t}(k),xn="audio/cash_register.mp3",Cn="audio/pixels.mp3",Sn="audio/sent_msg.mp3",wn="audio/tururu.mp3",En=function(){function e(){Object(s.a)(this,e),this._credits=void 0,this._pixels=void 0,this._consoleSent=void 0,this._consoleReceive=void 0,this._credits=new Audio(xn),this._pixels=new Audio(Cn),this._consoleSent=new Audio(Sn),this._consoleReceive=new Audio(wn)}return Object(l.a)(e,[{key:"playCreditsSound",value:function(){this._credits.play()}},{key:"playPixelsSound",value:function(){this._pixels.play()}},{key:"playConsoleSentSound",value:function(){this._consoleSent.play()}},{key:"playConsoleReceiveSound",value:function(){this._consoleReceive.play()}}]),e}(),_n=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,D))).appendString(e),n}return Object(h.a)(t,e),t}(k),Mn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,q))}return Object(h.a)(t,e),t}(k),On=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,L))}return Object(h.a)(t,e),t}(k),Rn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,z))}return Object(h.a)(t,e),t}(k),Tn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,H))).appendInt(e),n}return Object(h.a)(t,e),t}(k),jn=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,W))).appendString(e),a.appendString(n),a}return Object(h.a)(t,e),t}(k),Nn=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"requestSearchRooms",value:function(e){qn.getGame().communicationManager.sendMessage(new _n(e))}},{key:"requestPopularRooms",value:function(){qn.getGame().communicationManager.sendMessage(new Mn)}},{key:"requestOwnRooms",value:function(){qn.getGame().communicationManager.sendMessage(new On)}},{key:"requestGoToRoom",value:function(e){qn.getGame().communicationManager.sendMessage(new Tn(e))}},{key:"requestLeaveRoom",value:function(){qn.getGame().communicationManager.sendMessage(new Rn)}},{key:"handleRoomDataList",value:function(e){qn.getGame().uiManager.onLoadRoomList(e)}},{key:"handleCurrentRoomData",value:function(e){qn.getGame().uiManager.onCurrentRoomDataLoad(e)}},{key:"requestCreateRoom",value:function(e,t){qn.getGame().communicationManager.sendMessage(new jn(e,t))}}]),e}(),Fn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,B))}return Object(h.a)(t,e),t}(k),Pn=function(){function e(){Object(s.a)(this,e),this.roomTileTexture=void 0,this.roomStairLTexture=void 0,this.roomStairRTexture=void 0}return Object(l.a)(e,[{key:"initialize",value:function(){this.roomTileTexture=qn.getGame().engine.getTextureFromImage(this.generateFloorTile(7)),this.roomStairLTexture=qn.getGame().engine.getTextureFromImage(this.generateStairL());var e=this.generateStairR();null!=e&&(this.roomStairRTexture=qn.getGame().engine.getTextureFromImage(e))}},{key:"generateRoomWallL",value:function(e){return qn.getGame().engine.getTextureFromImage(this.generateWallL(122+32*e))}},{key:"generateRoomWallR",value:function(e){return qn.getGame().engine.getTextureFromImage(this.generateWallR(122+32*e))}},{key:"generateRoomDoorL",value:function(){return qn.getGame().engine.getTextureFromImage(this.generateWallL(28))}},{key:"generateRoomDoorBeforeL",value:function(e){return qn.getGame().engine.getTextureFromImage(this.generateWallBeforeDoorL(122+32*e))}},{key:"generateStairL",value:function(){return this.generateStair("rgba(142,142,94,127)","#989865","#7A7A51","#838357","#676744","#6F6F49",!1)}},{key:"generateStairR",value:function(){return le(this.generateStair("rgba(142,142,94,127)","#989865","#676744","#6F6F49","#7A7A51","#838357",!0))}},{key:"generateStair",value:function(e,t,n,a,i,r,o){var s=document.createElement("canvas"),l=s.getContext("2d");if(s.width=99,s.height=88,null!=l){var c=[{x:32,y:0},{x:0,y:16},{x:24,y:28},{x:56,y:12}],u=[{x:32,y:0},{x:0,y:16},{x:10,y:21},{x:42,y:5}];l.strokeStyle=e,l.fillStyle=t,l.beginPath(),l.moveTo(c[0].x,c[0].y),l.lineTo(c[1].x,c[1].y),l.lineTo(c[2].x,c[2].y),l.lineTo(c[3].x,c[3].y),l.lineTo(c[0].x,c[0].y),l.closePath(),l.stroke(),l.fill();l.strokeStyle=n,l.fillStyle=a,l.beginPath(),l.moveTo(c[1].x-.5,c[1].y),l.lineTo(c[1].x-.5,c[1].y+7),l.lineTo(c[2].x-.5,c[2].y+7),l.lineTo(c[2].x-.5,c[2].y),l.closePath(),l.stroke(),l.fill(),l.strokeStyle=i,l.fillStyle=r,l.beginPath(),l.moveTo(c[3].x+.5,c[3].y),l.lineTo(c[3].x+.5,c[3].y+7),l.lineTo(c[2].x+.5,c[2].y+7),l.lineTo(c[2].x+.5,c[2].y),l.closePath(),l.stroke(),l.fill();for(var h=3;h>=0;h--){var d=10*h+26,m=13*h+19,g=7;o&&(1===h&&(g+=2),3!==h&&2!==h||(m+=1)),l.strokeStyle=e,l.fillStyle=t,l.beginPath(),l.moveTo(u[0].x+d,u[0].y+m),l.lineTo(u[1].x+d,u[1].y+m),l.lineTo(u[2].x+d,u[2].y+m),l.lineTo(u[3].x+d,u[3].y+m),l.lineTo(u[0].x+d,u[0].y+m),l.closePath(),l.stroke(),l.fill(),l.strokeStyle=n,l.fillStyle=a,l.beginPath(),l.moveTo(u[1].x-.5+d,u[1].y+m),l.lineTo(u[1].x-.5+d,u[1].y+g+m),l.lineTo(u[2].x-.5+d,u[2].y+g+m),l.lineTo(u[2].x-.5+d,u[2].y+m),l.closePath(),l.stroke(),l.fill(),l.strokeStyle=i,l.fillStyle=r,l.beginPath(),l.moveTo(u[3].x+.5+d,u[3].y+m),l.lineTo(u[3].x+.5+d,u[3].y+g+m),l.lineTo(u[2].x+.5+d,u[2].y+g+m),l.lineTo(u[2].x+.5+d,u[2].y+m),l.closePath(),l.stroke(),l.fill()}}return s}},{key:"generateFloorTile",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(t.width=64,t.height=39,null!=n){var a=[{x:32,y:0},{x:0,y:16},{x:32,y:32},{x:64,y:16}];n.strokeStyle="rgba(142,142,94,127)",n.fillStyle="#989865",n.beginPath(),n.moveTo(a[0].x,a[0].y),n.lineTo(a[1].x,a[1].y),n.lineTo(a[2].x,a[2].y),n.lineTo(a[3].x,a[3].y),n.lineTo(a[0].x,a[0].y),n.closePath(),n.stroke(),n.fill(),e>0&&(n.strokeStyle="#7A7A51",n.fillStyle="#838357",n.beginPath(),n.moveTo(a[1].x-.5,a[1].y),n.lineTo(a[1].x-.5,a[1].y+e),n.lineTo(a[2].x-.5,a[2].y+e),n.lineTo(a[2].x-.5,a[2].y),n.closePath(),n.stroke(),n.fill(),n.strokeStyle="#676744",n.fillStyle="#6F6F49",n.beginPath(),n.moveTo(a[3].x+.5,a[3].y),n.lineTo(a[3].x+.5,a[3].y+e),n.lineTo(a[2].x+.5,a[2].y+e),n.lineTo(a[2].x+.5,a[2].y),n.closePath(),n.stroke(),n.fill())}return t}},{key:"generateWallBeforeDoorL",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(t.width=40,t.height=24+e,null!=n){var a=[{x:32,y:0},{x:0,y:16},{x:8,y:20},{x:40,y:4}];n.strokeStyle="#6f717a",n.fillStyle="#70727a",n.beginPath(),n.moveTo(a[0].x,a[0].y),n.lineTo(a[1].x,a[1].y),n.lineTo(a[2].x,a[2].y),n.lineTo(a[3].x,a[3].y),n.lineTo(a[0].x,a[0].y),n.closePath(),n.stroke(),n.fill(),e>0&&(n.strokeStyle="#90929e",n.fillStyle="#90929e",n.beginPath(),n.moveTo(a[3].x,a[3].y),n.lineTo(a[3].x,a[3].y+e),n.lineTo(a[2].x,a[2].y+e),n.lineTo(a[2].x,a[2].y),n.closePath(),n.stroke(),n.fill())}return t}},{key:"generateWallR",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(t.width=40,t.height=24+e,null!=n){var a=[{x:8,y:0},{x:40,y:16},{x:32,y:20},{x:0,y:4}];n.strokeStyle="#70727a",n.fillStyle="#70727a",n.beginPath(),n.moveTo(a[0].x-.5,a[0].y),n.lineTo(a[1].x-.5,a[1].y),n.lineTo(a[2].x-.5,a[2].y),n.lineTo(a[3].x-.5,a[3].y),n.lineTo(a[0].x-.5,a[0].y),n.closePath(),n.stroke(),n.fill(),e>0&&(n.strokeStyle="#90929e",n.fillStyle="#90929e",n.beginPath(),n.moveTo(a[1].x-.5,a[1].y),n.lineTo(a[1].x-.5,a[1].y+e),n.lineTo(a[2].x-.5,a[2].y+e),n.lineTo(a[2].x-.5,a[2].y),n.closePath(),n.stroke(),n.fill(),n.strokeStyle="#b6b9c8",n.fillStyle="#b6b9c8",n.beginPath(),n.moveTo(a[3].x,a[3].y),n.lineTo(a[3].x,a[3].y+e),n.lineTo(a[2].x,a[2].y+e),n.lineTo(a[2].x,a[2].y),n.closePath(),n.stroke(),n.fill())}return t}},{key:"generateWallL",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(t.width=40,t.height=24+e,null!=n){var a=[{x:32,y:0},{x:0,y:16},{x:8,y:20},{x:40,y:4}];n.strokeStyle="#70727a",n.fillStyle="#70727a",n.beginPath(),n.moveTo(a[0].x,a[0].y),n.lineTo(a[1].x,a[1].y),n.lineTo(a[2].x,a[2].y),n.lineTo(a[3].x,a[3].y),n.lineTo(a[0].x,a[0].y),n.closePath(),n.stroke(),n.fill(),e>0&&(n.strokeStyle="#bbbecd",n.fillStyle="#bbbecd",n.beginPath(),n.moveTo(a[1].x-.5,a[1].y),n.lineTo(a[1].x-.5,a[1].y+e),n.lineTo(a[2].x-.5,a[2].y+e),n.lineTo(a[2].x-.5,a[2].y),n.closePath(),n.stroke(),n.fill(),n.strokeStyle="#90929e",n.fillStyle="#90929e",n.beginPath(),n.moveTo(a[3].x,a[3].y),n.lineTo(a[3].x,a[3].y+e),n.lineTo(a[2].x,a[2].y+e),n.lineTo(a[2].x,a[2].y),n.closePath(),n.stroke(),n.fill())}return t}}]),e}(),Gn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,Q))}return Object(h.a)(t,e),t}(k),An=function e(){Object(s.a)(this,e)};An.WS_URL="wss://game.bobba.io/",An.AVATAR_RESOURCES_URL="https://images.bobba.io/gordon/PRODUCTION-202006192205-424220153/",An.FURNI_RESOURCES_URL="https://images.bobba.io/dcr/hof_furni/",An.CATALOGUE_RESOURCES_URL="https://images.bobba.io/c_images/catalogue/",An.TOP_STORY_RESOURCES_URL="https://images.bobba.io/c_images/Top_Story_Images/",An.BADGE_RESOURCES_URL="https://images.bobba.io/c_images/album1584/";var Un=function(){function e(){var t=this;Object(s.a)(this,e),this.currentRoom=void 0,this.engine=void 0,this.avatarImager=void 0,this.furniImager=void 0,this.chatImager=void 0,this.meMenuImager=void 0,this.roomImager=void 0,this.baseItemManager=void 0,this.userManager=void 0,this.ghostTextures=void 0,this.communicationManager=void 0,this.inventory=void 0,this.catalogue=void 0,this.navigator=void 0,this.messenger=void 0,this.uiManager=void 0,this.soundManager=void 0,this.isStarting=void 0,this.onMouseMove=function(e,n,a){null!=t.currentRoom&&t.currentRoom.engine.handleMouseMovement(e,n,a)},this.onTouchStart=function(e,n){null!=t.currentRoom&&t.currentRoom.engine.handleTouchStart(e,n)},this.onTouchMove=function(e,n){null!=t.currentRoom&&t.currentRoom.engine.handleTouchMove(e,n)},this.onMouseClick=function(e,n,a,i,r){null!=t.currentRoom&&t.currentRoom.engine.handleMouseClick(e,n,a,i,r,!0)},this.onMouseDoubleClick=function(e,n){null!=t.currentRoom&&t.currentRoom.engine.handleMouseDoubleClick(e,n)},this.onResize=function(){null!=t.currentRoom&&t.currentRoom.engine.onResize()},this.gameLoop=function(e){null!=t.currentRoom&&t.currentRoom.tick(e*(1/60)*1e3)},this.engine=new m(this.gameLoop,this.onResize,this.onMouseMove,this.onTouchStart,this.onTouchMove,this.onMouseClick,this.onMouseDoubleClick),this.soundManager=new En,this.ghostTextures=new We(Xe,!0),this.avatarImager=new ut(An.AVATAR_RESOURCES_URL),this.furniImager=new he(An.FURNI_RESOURCES_URL),this.chatImager=new sn,this.roomImager=new Pn,this.meMenuImager=new ln,this.userManager=new gn,this.baseItemManager=new dt(this.furniImager),this.communicationManager=new an,this.inventory=new fn,this.catalogue=new In,this.navigator=new Nn,this.messenger=new $t,this.uiManager=new dn(this),this.isStarting=!1}return Object(l.a)(e,[{key:"loadGame",value:function(){var e=this;this.isStarting=!0;var t=["assets/selected_tile.png",g,p,I];return this.uiManager.postLoading("Initializing game engine"),Promise.all([this.avatarImager.initialize().then((function(){return e.ghostTextures.initialize()})),this.furniImager.initialize(),this.chatImager.initialize(),this.meMenuImager.initialize(),this.roomImager.initialize(),this.engine.loadGlobalTextures(t)]).then((function(){return e.uiManager.postLoading("Connecting to server"),e.communicationManager.connect(An.WS_URL)}))}},{key:"handleUserData",value:function(e,t,n,a){this.uiManager.onSetUserData(this.userManager.setCurrentUser(e,t,a,n)),null==this.currentRoom&&(this.uiManager.log("Logged in!"),this.communicationManager.sendMessage(new pn),this.communicationManager.sendMessage(new kn),this.communicationManager.sendMessage(new Gn),this.soundManager.playPixelsSound(),this.uiManager.doOpenNavigator(),this.uiManager.doRequestOpenMessenger(),this.uiManager.onCloseRoomInfo(),this.communicationManager.sendMessage(new Tn(-1)))}},{key:"handleRoomModelInfo",value:function(e,t){this.communicationManager.sendMessage(new Fn)}},{key:"handleHeightMap",value:function(e){this.unloadRoom(),this.engine.onEnterRoom(),this.currentRoom=new st(e),this.engine.getLogicStage().addChild(this.currentRoom.engine.getLogicStage()),this.engine.getMainStage().addChild(this.currentRoom.engine.getStage()),this.uiManager.log("Loaded heightmap"),this.uiManager.onCloseNavigator(),this.uiManager.onCloseCreateRoom(),this.uiManager.onCloseCatalogue(),this.uiManager.onCloseInventory(),this.uiManager.onCloseChangeLooks(),this.communicationManager.sendMessage(new rn)}},{key:"unloadRoom",value:function(){null!=this.currentRoom&&(this.currentRoom.dispose(),this.engine.onLeaveRoom(),this.uiManager.onCloseSelectFurni(-1),this.uiManager.onCloseSelectUser(-1),this.uiManager.onCloseRoomInfo(),this.uiManager.doOpenNavigator()),this.currentRoom=void 0}},{key:"stop",value:function(){this.unloadRoom(),this.uiManager.onGameStop(),console.log("Stopping game...")}}]),e}(),qn=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"getGame",value:function(){return null==this._gameInstance&&(this._gameInstance=new Un),this._gameInstance}}]),e}();qn._gameInstance=void 0;n(43);var Ln,Dn=95,zn={chat:"",messengerAlert:!1},Hn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).chatInput=void 0,n.focusChatInput=function(){null!=n.chatInput.current&&n.chatInput.current.focus()},n.handleSubmit=function(e){var t=n.state.chat;e.preventDefault(),t.length>0&&t.length<=Dn&&qn.getGame().uiManager.doChat(t),n.setState(zn)},n.handleInputChange=function(e){var t=e.target.value;n.setState({chat:t})},n.changeLooks=function(){qn.getGame().uiManager.doOpenChangeLooks()},n.openInventory=function(){qn.getGame().uiManager.doOpenInventory()},n.openCatalogue=function(){qn.getGame().uiManager.doOpenCatalogue()},n.openNavigator=function(){qn.getGame().uiManager.doOpenNavigator()},n.leaveRoom=function(){qn.getGame().uiManager.doRequestLeaveRoom()},n.openMessenger=function(){qn.getGame().uiManager.doRequestOpenMessenger()},n.openChat=function(){n.setState({messengerAlert:!1}),qn.getGame().uiManager.doRequestOpenChat()},n.state=zn,n.chatInput=r.a.createRef(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.focuser(this.focusChatInput),qn.getGame().uiManager.onShowMessengerAlert=function(){e.setState({messengerAlert:!0})}}},{key:"render",value:function(){var e=this.state,t=e.chat,n=e.messengerAlert,a=this.props.headImage,i=r.a.createElement("button",null,r.a.createElement("img",{src:"images/bottom_bar/ghosthead.png",alt:"Me"}));return void 0!==a&&(i=r.a.createElement("button",{className:"user_face",onClick:this.changeLooks},r.a.createElement("img",{src:a.src,alt:"Me"}))),r.a.createElement("footer",null,r.a.createElement("div",{className:"footer_container"},r.a.createElement("div",{className:"left_section"},r.a.createElement("button",{onClick:this.leaveRoom},r.a.createElement("img",{src:"images/bottom_bar/logo.png",alt:"Return"})),r.a.createElement("button",{onClick:this.openNavigator},r.a.createElement("img",{src:"images/bottom_bar/rooms.png",alt:"Rooms"})),r.a.createElement("button",{onClick:this.openCatalogue},r.a.createElement("img",{src:"images/bottom_bar/shop.png",alt:"Shop"})),r.a.createElement("button",{onClick:this.openInventory},r.a.createElement("img",{src:"images/bottom_bar/inventory.png",alt:"Me"}))),r.a.createElement("div",{className:"middle_section"},i,r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("input",{type:"text",ref:this.chatInput,maxLength:Dn,name:"chat",value:t,autoComplete:"off",placeholder:"Click here to chat",onChange:this.handleInputChange}),r.a.createElement("button",null,r.a.createElement("img",{src:"images/bottom_bar/chat_styles.png",alt:"Chat styles"})))),r.a.createElement("div",{className:"right_section"},r.a.createElement("button",{onClick:this.openMessenger},r.a.createElement("img",{src:"images/bottom_bar/all_friends.png",alt:"Friends"})),r.a.createElement("button",{onClick:this.openChat},r.a.createElement("img",{src:"images/bottom_bar/"+(n?"messenger_notify0":"messenger")+".png",alt:"Messenger"})))))}}]),t}(i.Component),Bn=(n(44),n(7)),Wn=n.n(Bn),Zn=(n(45),{visible:!0,roomData:new qt(1,"The deep forest","Relevance","Cool room",0,0,!1,de.Open)}),Yn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=Zn,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;qn.getGame().uiManager.onCurrentRoomDataLoad=function(t){e.setState({roomData:t,visible:!0})},qn.getGame().uiManager.onCloseRoomInfo=function(){e.setState({visible:!1})}}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.roomData;return t?r.a.createElement(Wn.a,null,r.a.createElement("div",{className:"room_info"},r.a.createElement("h2",{className:"title"},n.name),r.a.createElement("p",{className:"owner_info"},"Owner: ",r.a.createElement("span",{className:"owner_name"},n.owner)),r.a.createElement("div",{className:"buttons_container"},r.a.createElement("button",null,r.a.createElement("img",{src:"images/room_info/clear_favourite.png",alt:"Favorite"})),r.a.createElement("button",null,r.a.createElement("img",{src:"images/room_info/settings_icon.png",alt:"Settings"})),r.a.createElement("button",null,r.a.createElement("img",{src:"images/room_info/chat_history.png",alt:"Chat history"}))))):r.a.createElement(r.a.Fragment,null)}}]),t}(i.Component),Xn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"top_bar"},r.a.createElement("button",{className:"bar_content"},r.a.createElement("img",{src:"images/top_bar/settings.png",alt:"Settings"})),r.a.createElement("button",{className:"bar_content"},r.a.createElement("img",{src:"images/top_bar/logout.png",alt:"Logout"})))}}]),t}(i.Component),Vn=(n(46),{credits:420}),Jn=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=Vn,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;qn.getGame().uiManager.onUpdateCreditsBalance=function(t){e.setState({credits:t})}}},{key:"getMoneyNumber",value:function(e){return e.toLocaleString(navigator.language,{minimumFractionDigits:0})}},{key:"render",value:function(){var e=this.state.credits;return r.a.createElement("header",null,r.a.createElement("div",{className:"bar_content"},r.a.createElement("span",null,this.getMoneyNumber(e)),r.a.createElement("img",{src:"images/top_bar/credits.png",alt:"Credits"})),r.a.createElement("div",{className:"bar_content"},r.a.createElement("span",{className:"logo"},"bobba.io")),r.a.createElement("div",{className:"bar_content"},r.a.createElement("span",null,"69"),r.a.createElement("img",{src:"images/top_bar/hc.png",alt:"Habbo club"})))}}]),t}(i.Component),Kn=n(26),$n=20,Qn={username:"",look:"",wrongUsername:!1,queuedLogin:!1},ea=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleInputChange=function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,i=t.name;n.setState(Object(Kn.a)({},i,a))},n.handleSubmit=function(e){var t=n.state,a=t.username,i=t.look;e.preventDefault(),a.length>0||a.length>$n?(qn.getGame().uiManager.doLogin(a,i),n.setState({queuedLogin:!0})):n.setState({wrongUsername:!0})},n.state=Qn,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.look,t=this.props.looks;if(""===e){var n=t[Math.floor(Math.random()*t.length)];null!=n&&this.setState({look:n.figure})}}},{key:"getLooks",value:function(){var e=this,t=0,n=this.state.look;return this.props.looks.map((function(a){var i=a.figure===n;return r.a.createElement("div",{key:t++,className:"look_item"},r.a.createElement("img",{src:a.image.src,alt:"look"}),r.a.createElement("br",null),r.a.createElement("input",{checked:i,type:"radio",onChange:e.handleInputChange,name:"look",value:a.figure}))}))}},{key:"render",value:function(){var e=this.state,t=e.username,n=e.wrongUsername?"wrong":"",a=e.queuedLogin?r.a.createElement("button",{disabled:!0},"Loading..."):r.a.createElement("button",null,"Join");return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("input",{type:"text",autoComplete:"off",maxLength:$n,className:n,placeholder:"Username",name:"username",onChange:this.handleInputChange,value:t}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:"looks"},this.getLooks()),r.a.createElement("br",null),r.a.createElement("br",null),a)}}]),t}(r.a.Component),ta=(n(47),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"logo"},r.a.createElement("div",null,r.a.createElement("img",{src:"images/bottom_bar/ghosthead.png",alt:"Bobba"}),r.a.createElement("h1",null,"bobba")))}}]),t}(r.a.Component)),na=function(){return r.a.createElement("p",{className:"main_content_footer"},"Habbo is a registered trademark of Sulake Oy. All rights reserved to their respective owners.",r.a.createElement("br",null),r.a.createElement("span",{style:{fontFamily:"'Volter'",fontSize:"9px"}},"Made with | by Relevance. Follow me on ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.instagram.com/josednn/"},"instagram"),"."))},aa=(n(48),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"main_wrapper"},r.a.createElement(Wn.a,{handle:".logo"},r.a.createElement("div",{className:"main_container"},r.a.createElement("div",{className:"main_content"},r.a.createElement("button",{className:"close"},"X"),r.a.createElement(ta,null),r.a.createElement("hr",null),this.props.children),r.a.createElement(na,null))))}}]),t}(i.Component)),ia=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.loadingText;return r.a.createElement(aa,null,r.a.createElement("div",{className:"loading"},r.a.createElement("img",{src:"images/loading.gif",alt:"Loading"}),r.a.createElement("p",null,"Loading..."),r.a.createElement("p",{className:"loading_info"},e)))}}]),t}(i.Component),ra=function(e){var t=document.createElement("img");return t.src=e.toDataURL(),t},oa=["hd-190-10.lg-3023-1408.ch-215-91.hr-893-45","hr-828-1407.sh-3089-110.ha-1013-110.ch-3323-110-92.lg-3058-82.hd-180-10","ch-3050-104-62.ea-987462904-62.sh-305-1185.lg-275-1193.hd-185-1.hr-828-1034","sh-725-68.he-3258-1410-92.hr-3012-45.ch-665-110.lg-3006-110-110.hd-600-28","ha-1003-85.ch-665-92.lg-3328-1338-1338.hd-3105-10.sh-3035-64.hr-3012-1394.ea-3169-110.cc-3008-110-110","ca-1811-62.lg-3018-81.hr-836-45.ch-669-1193.hd-627-10"],sa={looks:[],looksLoaded:0},la=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=sa,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame().avatarImager;oa.forEach((function(n){t.generateGeneric(new De(n,4,4,["wlk"],"std",2,!1,!1,"n"),!1).then((function(t){var a=e.state.looks.concat({figure:n,image:ra(t)});e.setState({looks:a})}))}))}},{key:"render",value:function(){var e,t,n=this.state.looks;return n.length!==oa.length?r.a.createElement(ia,{loadingText:"Loading sample looks ("+(e=n.length,t=oa.length,Math.trunc(e/t*100))+"%)"}):r.a.createElement(aa,null,r.a.createElement("p",null,"Please enter your username and pick a look!"),r.a.createElement(ea,{looks:n}))}}]),t}(i.Component),ca=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).useItem=function(){var e=n.props.itemId;-1!==e&&qn.getGame().uiManager.doFurniInteract(e)},n.moveItem=function(){var e=n.props.itemId;-1!==e&&qn.getGame().uiManager.doFurniMove(e)},n.rotateItem=function(){var e=n.props.itemId;-1!==e&&qn.getGame().uiManager.doFurniRotate(e)},n.pickUpItem=function(){var e=n.props.itemId;-1!==e&&qn.getGame().uiManager.doFurniPickUp(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.description,a=e.image,i=e.onClose,o=e.canRotate,s=e.canMove,l=e.canPickUp,c=e.canUse,u=g;null!=a&&null!=a.src&&(u=a.src);var h=[];return s&&h.push(r.a.createElement("button",{key:"move",onClick:this.moveItem},"Move")),o&&h.push(r.a.createElement("button",{key:"rotate",onClick:this.rotateItem},"Rotate")),l&&h.push(r.a.createElement("button",{key:"pickup",onClick:this.pickUpItem},"Pick up")),c&&h.push(r.a.createElement("button",{key:"use",onClick:this.useItem},"Use")),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"item_info"+(0===h.length?" no_buttons":"")},r.a.createElement("button",{className:"close",onClick:i},"X"),r.a.createElement("h2",{className:"title"},t),r.a.createElement("hr",null),r.a.createElement("div",{className:"image_container"},r.a.createElement("img",{src:u,alt:t})),r.a.createElement("hr",null),r.a.createElement("p",null,n)),r.a.createElement("div",{className:"item_info_button_container"},h))}}]),t}(i.Component),ua=n(27),ha=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.motto,n=e.onMottoChange;return r.a.createElement(ua.RIEInput,{value:t,change:function(e){return n(e.motto)},classLoading:"loading",propName:"motto",editProps:{maxLength:80}})}}]),t}(r.a.Component),da=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).handleWave=function(){-1!==n.props.userId&&qn.getGame().uiManager.doWave()},n.handleChangeLooks=function(){qn.getGame().uiManager.doOpenChangeLooks()},n.handleChangeMotto=function(e){qn.getGame().uiManager.doChangeMotto(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.motto,a=e.image,i=e.onClose,o=e.isMe,s=g;null!=a&&null!=a.src&&(s=a.src);var l="item_info no_buttons",c=r.a.createElement(r.a.Fragment,null),u=r.a.createElement(r.a.Fragment,null,n);return o&&(c=r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.handleChangeLooks},r.a.createElement("span",null,"Change looks")),r.a.createElement("button",{onClick:this.handleWave},r.a.createElement("span",null,"Wave"))),u=r.a.createElement(ha,{motto:n,onMottoChange:this.handleChangeMotto}),l="item_info"),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:l},r.a.createElement("button",{className:"close",onClick:i},"X"),r.a.createElement("h2",{className:"title"},t),r.a.createElement("hr",null),r.a.createElement("div",{className:"user_container"},r.a.createElement("div",{className:"avatar_container"},r.a.createElement("img",{src:s,alt:t})),r.a.createElement("div",{className:"badge_container"},r.a.createElement("button",null,r.a.createElement("img",{src:An.BADGE_RESOURCES_URL+"J0S3.gif",alt:"ADM"})),r.a.createElement("button",null,r.a.createElement("img",{src:An.BADGE_RESOURCES_URL+"ADM.gif",alt:"ADM"})),r.a.createElement("button",null,r.a.createElement("img",{src:An.BADGE_RESOURCES_URL+"Z64.gif",alt:"ADM"})))),r.a.createElement("hr",null),r.a.createElement("p",{className:"motto"},u)),r.a.createElement("div",{className:"item_info_button_container"},c))}}]),t}(i.Component);n(58);!function(e){e[e.USER=0]="USER",e[e.FURNI=1]="FURNI",e[e.NONE=2]="NONE"}(Ln||(Ln={}));var ma={showing:Ln.NONE,furniProps:{showing:!0,name:"",description:"",itemId:-1,canRotate:!1,canMove:!1,canPickUp:!1,canUse:!1},userProps:{showing:!0,name:"",motto:"",userId:-1,isMe:!1}},ga=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).close=function(){n.setState({showing:Ln.NONE})},n.showFurniView=function(e,t,a,i,r,o,s,l,c,u){var h=n.state.furniProps.itemId;(o&&n.state.showing===Ln.FURNI&&h===e||!o)&&n.setState({furniProps:{itemId:e,name:a,description:i,image:ra(r),canRotate:l,canMove:s,canPickUp:c,canUse:u},showing:Ln.FURNI})},n.showUserView=function(e,t,a,i,r,o,s){var l=n.state.userProps.userId;(s&&n.state.showing===Ln.USER&&l===e||!s)&&n.setState({userProps:{userId:e,name:t,motto:a,image:ra(o),isMe:r},showing:Ln.USER})},n.tryCloseFurniView=function(e){e!==n.state.furniProps.itemId&&-1!==e||n.close()},n.tryCloseUserView=function(e){e!==n.state.userProps.userId&&-1!==e||n.close()},n.state=ma,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){qn.getGame().uiManager.onSelectFurni=this.showFurniView,qn.getGame().uiManager.onSelectUser=this.showUserView,qn.getGame().uiManager.onCloseSelectFurni=this.tryCloseFurniView,qn.getGame().uiManager.onCloseSelectUser=this.tryCloseUserView}},{key:"render",value:function(){var e=this.state,t=e.showing,n=e.furniProps,a=e.userProps;return t===Ln.FURNI?r.a.createElement(ca,Object.assign({},n,{onClose:this.close})):t===Ln.USER?r.a.createElement(da,Object.assign({},a,{onClose:this.close})):r.a.createElement(r.a.Fragment,null)}}]),t}(i.Component),va=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.errorText;return r.a.createElement(aa,null,r.a.createElement("p",null,e))}}]),t}(i.Component),fa=(n(59),function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"getNextZIndex",value:function(){return this.currentZIndex++}}]),e}());fa.currentZIndex=10;var pa,ba=[{id:"generic",tabs:[{type:"hd",name:"Skin",image:"avatar_editor_download_icon",required:!0}]},{id:"head",tabs:[{type:"hr",name:"Hair",image:"head_hair",required:!1},{type:"ha",name:"Hat",image:"head_hats",required:!1},{type:"he",name:"Accesories",image:"head_accessories",required:!1},{type:"ea",name:"Glass",image:"head_eyewear",required:!1},{type:"fa",name:"Masks",image:"head_face_accessories",required:!1}]},{id:"torso",tabs:[{type:"ch",name:"Top",image:"top_shirt",required:!0},{type:"cc",name:"Jacket",image:"top_jacket",required:!1},{type:"ca",name:"Collar",image:"top_accessories",required:!1},{type:"cp",name:"More",image:"top_prints",required:!1}]},{id:"legs",tabs:[{type:"lg",name:"Pants",image:"bottom_trousers",required:!0},{type:"sh",name:"Shoes",image:"bottom_shoes",required:!1},{type:"wa",name:"Belts",image:"bottom_accessories",required:!1}]}],ya={visible:!1,mainTab:"generic",secondTabId:0,look:"",gender:"M",zIndex:fa.getNextZIndex()},Ia=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleMainTabChange=function(e){return function(){n.setState({mainTab:e,secondTabId:0})}},n.handleSecondTabChange=function(e){return function(){n.setState({secondTabId:e})}},n.handleChangePart=function(e){return function(){var t=n.state.look,a=He(ze(t+"."+e));n.setState({look:a})}},n.handleChangeColor=function(e,t){return function(){var a=n.state.look,i=n.calculateCurrentPart();if(null!=i){i.colors[e]=t.toString();var r=He(ze(a+"."+He([i])));n.setState({look:r})}}},n.handleRemovePart=function(e){return function(){var t=n.state.look,a=He(ze(t).filter((function(t){return t.type!==e})));n.setState({look:a})}},n.handleToggleGender=function(e){return function(){n.setState({gender:e})}},n.handleSaveChanges=function(){n.setState({visible:!1});var e=n.state,t=e.look,a=e.gender;qn.getGame().uiManager.doChangeLooks(t,a)},n.handleClose=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.state=ya,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame();t.uiManager.onOpenChangeLooks=function(t){e.setState({visible:!0,look:t,zIndex:fa.getNextZIndex()})},t.uiManager.onCloseChangeLooks=function(){e.setState({visible:!1})}}},{key:"getMainTabs",value:function(){var e=this,t=this.state.mainTab;return ba.map((function(n){return r.a.createElement("button",{key:n.id,onClick:e.handleMainTabChange(n.id),className:t===n.id?"selected":""},r.a.createElement("img",{src:"images/avatar_editor/ae_tabs_"+n.id+".png",alt:n.id}))}))}},{key:"getSecondTab",value:function(){var e=this,t=this.state,n=t.mainTab,a=t.secondTabId,i=t.gender,o=ba.find((function(e){return e.id===n}));if(void 0!==o){var s=0;if("generic"===o.id){var l="M"===i;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.handleToggleGender("M"),className:"gender "+(l?"selected":"")},r.a.createElement("img",{src:"images/avatar_editor/gender_male.png",alt:"Boy"}),r.a.createElement("span",null,"Boy")),r.a.createElement("button",{onClick:this.handleToggleGender("F"),className:"gender "+(l?"":"selected")},r.a.createElement("img",{src:"images/avatar_editor/gender_female.png",alt:"Girl"}),r.a.createElement("span",null,"Girl")))}return o.tabs.map((function(t){var n=a===s,i=t.name,o="images/avatar_editor/"+t.image+".png";return r.a.createElement("button",{key:t.name,onClick:e.handleSecondTabChange(s++),className:n?"selected":""},r.a.createElement("img",{src:o,alt:i}))}))}return[]}},{key:"calculateCurrentColor",value:function(e){var t=this.state,n=t.mainTab,a=t.secondTabId,i=t.look,r=ba.find((function(e){return e.id===n}));if(void 0!==r){var o=r.tabs[a],s=ze(i).find((function(e){return e.type===o.type}));if(void 0!==s)return parseInt(s.colors[e])}return 0}},{key:"calculateCurrentPart",value:function(){var e=this.state,t=e.mainTab,n=e.secondTabId,a=e.look,i=ba.find((function(e){return e.id===t}));if(void 0!==i){var r=i.tabs[n],o=ze(a).find((function(e){return e.type===r.type}));if(void 0!==o)return o}return null}},{key:"generatePalette",value:function(e){var t=this.state,n=t.mainTab,a=t.secondTabId,i=ba.find((function(e){return e.id===n}));if(void 0!==i){var o=i.tabs[a];if(null!=o){var s=qn.getGame().avatarImager.getPartPalette(o.type),l=[],c=this.calculateCurrentColor(e);for(var u in s){var h=parseInt(u),d=s[h],m=h===c,g=0!==d.club;l.push(r.a.createElement("button",{onClick:this.handleChangeColor(e,h),key:h,className:(m?"selected ":"")+(g?"hc ":"")},r.a.createElement("div",{className:"palette",style:{backgroundColor:"#"+d.color}})))}return l}}return[]}},{key:"generatePalettes",value:function(){var e=this.calculateCurrentPart(),t=[],n=1;null!=e&&(n=qn.getGame().avatarImager.getPartPaletteCount(e.type,e.id));for(var a=0;a<n;a++)t.push(r.a.createElement("div",{key:a,className:"colors_container"},this.generatePalette(a)));return t}},{key:"generatePartImage",value:function(e,t,n){var a=r.a.createRef();return qn.getGame().avatarImager.generateGeneric(new De(e,4,4,["std"],"std",0,"generic"===n,!1,"n"),!1).then((function(e){var i=ra(e),r=a.current;null!=r&&(r.src=i.src,r.className=n+(t?" selected ":""))})),r.a.createElement("img",{className:t?"selected ":"",ref:a,src:"images/avatar_editor/avatar_editor_download_icon.png",alt:e})}},{key:"generatePlatform",value:function(){var e=this.state.look;if(""===e)return r.a.createElement(r.a.Fragment,null);var t=r.a.createRef();return qn.getGame().avatarImager.generateGeneric(new De(e,4,4,["std"],"std",0,!1,!1,"n"),!1).then((function(e){var n=ra(e),a=t.current;null!=a&&(a.src=n.src,a.className+=" loaded")})),r.a.createElement("img",{ref:t,alt:"Me"})}},{key:"generateGrid",value:function(){var e=this.state,t=e.mainTab,n=e.secondTabId,a=e.gender,i=ba.find((function(e){return e.id===t}));if(void 0!==i){var o=i.tabs[n];if(null!=o){var s=qn.getGame().avatarImager.getPartSet(o.type),l=[],c=this.calculateCurrentPart(),u=this.calculateCurrentColor(0).toString();for(var h in null!=c&&c.colors.length>1&&(u+="-"+this.calculateCurrentColor(1)),o.required||l.push(r.a.createElement("button",{onClick:this.handleRemovePart(o.type),key:-1,className:null==c?"selected ":""},r.a.createElement("img",{src:"images/avatar_editor/removeSelection.png",alt:"Remove"}))),s){var d=s[h],m=null!=c&&c.id===h,g=0!==d.club,v=o.type+"-"+h+"-"+u;d.gender!==a&&"U"!==d.gender||!d.selectable||l.push(r.a.createElement("button",{onClick:this.handleChangePart(v),key:h,className:(m?"selected ":"")+(g?"hc ":"")},this.generatePartImage(v,m,i.id)))}return l}}return[]}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex;return n?r.a.createElement(Wn.a,{defaultClassName:"avatar_editor",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.handleClose},"X"),r.a.createElement("h2",{className:"title"},"Change your looks"),r.a.createElement("hr",null),r.a.createElement("div",{className:"main_tab_container"},this.getMainTabs()),r.a.createElement("div",{className:"parts_container"},r.a.createElement("div",{className:"second_tab_container"},this.getSecondTab()),r.a.createElement("div",{className:"first_row"},r.a.createElement("div",{className:"parts_grid"},this.generateGrid()),r.a.createElement("div",{className:"platform"},this.generatePlatform())),r.a.createElement("div",{className:"palette_container"},this.generatePalettes())),r.a.createElement("div",{className:"button_container"},r.a.createElement("button",{onClick:this.handleClose},"Cancel"),r.a.createElement("button",{onClick:this.handleSaveChanges},"Save changes")))):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component),ka=(n(60),{visible:!1,selectedId:-1,currentType:a.FloorItem,items:[],zIndex:fa.getNextZIndex()}),xa=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleSelectItem=function(e){return function(){n.setState({selectedId:e})}},n.placeItem=function(){var e=n.state.selectedId;qn.getGame().uiManager.doFurniPlace(e)},n.close=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.toggleType=function(e){return function(){n.setState({currentType:e})}},n.state=ka,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame();t.uiManager.onOpenInventory=function(){e.setState({visible:!0,zIndex:fa.getNextZIndex()})},t.uiManager.onUpdateInventory=function(t){e.setState({items:t})},t.uiManager.onCloseInventory=function(){e.setState({visible:!1})}}},{key:"generateGrid",value:function(){var e=this,t=this.state,n=t.selectedId,a=t.items,i=t.currentType,o={},s={},l=[];return a.forEach((function(e){null==o[e.baseId]?o[e.baseId]=1:o[e.baseId]++,s[e.baseId]=0})),a.filter((function(e){return i===e.itemType})).forEach((function(t){var a=o[t.baseId];if(t.stackable&&0===s[t.baseId]++||!t.stackable)if(null!=t.baseItem){var i=ra(t.baseItem.iconImage);l.push(r.a.createElement("button",{key:t.id,onClick:e.handleSelectItem(t.id),className:t.id===n?"selected":""},r.a.createElement("img",{src:i.src,alt:t.baseItem.furniBase.itemData.name}),a>1?r.a.createElement("span",null,a):r.a.createElement(r.a.Fragment,null)))}else l.push(r.a.createElement("button",{key:t.id,onClick:e.handleSelectItem(t.id),className:t.id===n?"selected":""},r.a.createElement("img",{src:"images/avatar_editor/avatar_editor_download_icon.png",alt:"Loading"}),a>1?r.a.createElement("span",null,a):r.a.createElement(r.a.Fragment,null)))})),l}},{key:"generateItemInfo",value:function(){var e=this.state.selectedId,t=qn.getGame().inventory.getItem(e);if(null==t||null==t.baseItem)return r.a.createElement("div",{className:"item_preview"},r.a.createElement("div",{className:"image_container"},r.a.createElement("img",{src:g,alt:"Furni"})),r.a.createElement("div",{className:"item_data"},r.a.createElement("h2",null,"Select an item")));var n=t.baseItem.furniBase.itemData,a=ra(t.baseItem.infoImage);return r.a.createElement("div",{className:"item_preview"},r.a.createElement("div",{className:"image_container"},r.a.createElement("img",{src:a.src,alt:"Furni"})),r.a.createElement("div",{className:"item_data"},r.a.createElement("h2",null,n.name),r.a.createElement("p",null,n.description),r.a.createElement("button",{onClick:this.placeItem},"Place to room")))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex;return n?r.a.createElement(Wn.a,{defaultClassName:"inventory",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.close},"X"),r.a.createElement("h2",{className:"title"},"Inventory"),r.a.createElement("hr",null),r.a.createElement("div",{className:"main_tab_container"},r.a.createElement("button",{className:"selected"},"Furniture"),r.a.createElement("button",null,"Badges")),r.a.createElement("div",{className:"items_container"},r.a.createElement("div",{className:"second_tab_container"},this.generateSecondTab()),r.a.createElement("div",{className:"grid_container"},r.a.createElement("div",{className:"grid"},this.generateGrid()),this.generateItemInfo())))):r.a.createElement(r.a.Fragment,null)}},{key:"generateSecondTab",value:function(){var e=this.state.currentType===a.FloorItem;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.toggleType(a.FloorItem),className:e?"selected":""},"Floor"),r.a.createElement("button",{onClick:this.toggleType(a.WallItem),className:e?"":"selected"},"Wall"))}}]),t}(r.a.Component),Ca=(n(61),n(62),{visible:!0}),Sa=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=Ca,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.onClose,a=e.onPurchase,i=e.zIndex;if(null==t.baseItem)return r.a.createElement(r.a.Fragment,null);var o=ra(t.baseItem.iconImage);return r.a.createElement(Wn.a,{handle:".handle"},r.a.createElement("div",{className:"catalogue_confirm_purchase",style:{zIndex:i}},r.a.createElement("button",{className:"close",onClick:n},"X"),r.a.createElement("h2",{className:"handle"},"Confirmar compra"),r.a.createElement("hr",null),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"first_row"},r.a.createElement("button",null,r.a.createElement("img",{src:o.src,alt:t.baseItem.furniBase.itemData.name})),r.a.createElement("h2",null,t.baseItem.furniBase.itemData.name)),r.a.createElement("div",{className:"second_row"},r.a.createElement("p",null,t.baseItem.furniBase.itemData.name," cuesta ",t.cost," cr\xe9dito",1===t.cost?"":"s","."),r.a.createElement("p",null,"Tienes 420 cr\xe9ditos.")),r.a.createElement("div",{className:"third_row"},r.a.createElement("button",{onClick:a},"Comprar"),r.a.createElement("button",null,"Regalar"),r.a.createElement("button",{onClick:n},"Cancelar")))))}}]),t}(r.a.Component),wa={pages:[],currentPage:void 0,currentPageId:-1,currentTabId:-1,currentItemId:-1,visible:!1,purchaseWindowVisible:!1,zIndex:fa.getNextZIndex()},Ea=[4293190884,4293914607,4294957908,4289454682,4289431551,4285716709,4294016606,4293326172,4293694138,4285383659,4293082689,4288782753],_a=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleClose=function(){n.setState({visible:!1})},n.handleSelectItem=function(e){return function(){n.setState({currentItemId:e})}},n.handleChangePage=function(e){return function(){var t=n.state,a=t.pages,i=t.currentTabId,r=a.find((function(t){return t.id===e}));r?r.children.length>0&&i!==e?n.setState({currentPageId:e,currentTabId:e,currentItemId:-1,purchaseWindowVisible:!1}):n.setState({currentPageId:e,currentTabId:-1,currentItemId:-1,purchaseWindowVisible:!1}):n.setState({currentPageId:e,currentItemId:-1,purchaseWindowVisible:!1}),qn.getGame().uiManager.doRequestCataloguePage(e)}},n.handleTryPurchase=function(){n.setState({purchaseWindowVisible:!0})},n.handlePurchase=function(){var e=n.state,t=e.currentItemId,a=e.currentPageId;qn.getGame().uiManager.doRequestCataloguePurchase(a,t),n.setState({purchaseWindowVisible:!1})},n.handlePurchaseWindowClose=function(){n.setState({purchaseWindowVisible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.state=wa,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame();t.uiManager.onOpenCatalogue=function(){e.setState({visible:!0,zIndex:fa.getNextZIndex()})},t.uiManager.onCloseCatalogue=function(){e.setState({visible:!1})},t.uiManager.onLoadCatalogueIndex=function(t){e.setState({pages:t,currentPage:void 0,currentItemId:-1,currentPageId:-1,currentTabId:-1})},t.uiManager.onLoadCataloguePage=function(t){e.setState({currentPage:t})}}},{key:"generateTabs",value:function(){var e=this,t=this.state,n=t.pages,a=t.currentPageId,o=t.currentTabId;return n.map((function(t){var n=t.children.map((function(t){return r.a.createElement("button",{onClick:e.handleChangePage(t.id),key:t.id,className:"second_tab"+(a===t.id?" selected":"")},r.a.createElement("div",{className:"icon"},r.a.createElement("img",{src:An.CATALOGUE_RESOURCES_URL+"icon_"+t.iconId+".png",alt:t.name})),r.a.createElement("span",null,t.name))})),s=Ea[t.color%Ea.length].toString(16).substr(2);return r.a.createElement(i.Fragment,{key:t.id},r.a.createElement("button",{onClick:e.handleChangePage(t.id),className:"main_tab"+(a===t.id?" selected":"")+(o===t.id?" open":"")},r.a.createElement("div",{className:"icon",style:{backgroundColor:"#"+s}},r.a.createElement("img",{src:An.CATALOGUE_RESOURCES_URL+"icon_"+t.iconId+".png",alt:t.name})),r.a.createElement("span",null,t.name)),o===t.id?n:r.a.createElement(r.a.Fragment,null))}))}},{key:"generateDescription",value:function(){var e=this.state,t=e.currentItemId,n=e.currentPage;if(null==n)return r.a.createElement(r.a.Fragment,null);if(-1!==t){var a=n.items.find((function(e){return e.itemId===t}));if(null!=a&&null!=a.baseItem){var i=ra(a.baseItem.infoImage);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image_container"},r.a.createElement("img",{src:i.src,alt:a.baseItem.furniBase.itemData.name})),r.a.createElement("div",{className:"description_container"},r.a.createElement("h2",null,a.baseItem.furniBase.itemData.name),r.a.createElement("p",null,a.baseItem.furniBase.itemData.description)),r.a.createElement("div",{className:"button_container"},r.a.createElement("span",null,a.cost," cr\xe9dito",1===a.cost?"":"s"),r.a.createElement("button",{onClick:this.handleTryPurchase},"Comprar")))}return r.a.createElement(r.a.Fragment,null)}return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image_container"},n.imageTeaser.length>0?r.a.createElement("img",{src:An.CATALOGUE_RESOURCES_URL+""+n.imageTeaser+".gif",alt:"Furniture"}):r.a.createElement(r.a.Fragment,null)),r.a.createElement("div",{className:"description_container"},n.textDetails))}},{key:"generateFurniButton",value:function(e){var t=this.state.currentItemId,n=r.a.createRef();return e.loadBase().then((function(e){var t=ra(e.iconImage),a=n.current;null!=a&&(a.src=t.src,a.alt=e.furniBase.itemData.name)})).catch((function(e){})),r.a.createElement("button",{key:e.itemId,onClick:this.handleSelectItem(e.itemId),className:t===e.itemId?"selected":""},r.a.createElement("img",{ref:n,src:"images/avatar_editor/avatar_editor_download_icon.png",alt:"Loading"}))}},{key:"generateGrid",value:function(){var e=this,t=this.state.currentPage;return null==t?r.a.createElement(r.a.Fragment,null):t.items.map((function(t){return e.generateFurniButton(t)}))}},{key:"generateFrontPage",value:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"frontpage_teaser"},r.a.createElement("img",{alt:"border",src:An.CATALOGUE_RESOURCES_URL+"front_page_border.gif",className:"border"}),r.a.createElement("img",{alt:"article",src:An.TOP_STORY_RESOURCES_URL+e.imageTeaser+".gif",className:"top_story"}),r.a.createElement("h2",null,e.textHeader),r.a.createElement("p",null,e.textDetails)),r.a.createElement("div",{className:"frontpage_content"},r.a.createElement("h2",null,e.textMisc),r.a.createElement("p",null,e.textMisc2)),r.a.createElement("div",{className:"frontpage_vouchers"},r.a.createElement("span",null,"Voucher code:"),r.a.createElement("input",{type:"text",name:"voucher"}),r.a.createElement("button",null,"Redeem")))}},{key:"generateDefaultPage",value:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"description"},e.textHeader),r.a.createElement("div",{className:"second_row"},r.a.createElement("div",{className:"grid_container"},r.a.createElement("div",{className:"title"},"Pick a furni"),r.a.createElement("div",{className:"grid"},this.generateGrid())),r.a.createElement("div",{className:"item_description"},this.generateDescription())))}},{key:"generatePage",value:function(){var e=this.state.currentPage;if(null!=e){var t=null;return t="frontpage"===e.layout?this.generateFrontPage(e):this.generateDefaultPage(e),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"header_container"},e.imageHeadline.length>0?r.a.createElement("img",{alt:"Furniture",src:An.CATALOGUE_RESOURCES_URL+""+e.imageHeadline+".gif"}):r.a.createElement(r.a.Fragment,null)),t)}return r.a.createElement(r.a.Fragment,null)}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.purchaseWindowVisible,i=t.currentItemId,o=t.currentPage,s=t.zIndex;if(!n)return r.a.createElement(r.a.Fragment,null);var l=r.a.createElement(r.a.Fragment,null);if(null!=o&&a){var c=o.items.find((function(e){return e.itemId===i}));null!=c&&null!=c.baseItem&&(l=r.a.createElement(Sa,{zIndex:fa.getNextZIndex(),item:c,onClose:this.handlePurchaseWindowClose,onPurchase:this.handlePurchase}))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Wn.a,{handle:".handle",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{className:"catalogue",style:{zIndex:s}},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"handle"}),this.generatePage()),r.a.createElement("div",{className:"navigator"},r.a.createElement("button",{className:"close",onClick:this.handleClose},"X"),r.a.createElement("h2",{className:"handle"},"Shop"),r.a.createElement("hr",null),r.a.createElement("div",{className:"tab_container"},this.generateTabs())))),l)}}]),t}(r.a.Component),Ma=(n(63),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleClose=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.state={visible:!0,zIndex:fa.getNextZIndex()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex,i=this.props,o=i.text,s=i.id;return n?r.a.createElement(Wn.a,{key:s,handle:".handle",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{className:"notification",style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.handleClose},"X"),r.a.createElement("h2",{className:"handle"},"Alert"),r.a.createElement("hr",null),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"first_row"},r.a.createElement("span",null,o)),r.a.createElement("div",{className:"second_row"},r.a.createElement("button",{onClick:this.handleClose},"Ok"))))):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component)),Oa={notifications:[]},Ra=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state=Oa,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;qn.getGame().uiManager.onShowNotification=function(t){var n=e.state.notifications;e.setState({notifications:n.concat(t)})}}},{key:"render",value:function(){var e=this.state.notifications,t=0;return e.map((function(e){return r.a.createElement(Ma,{id:t++,text:e})}))}}]),t}(r.a.Component),Ta=(n(64),{visible:!0,mainTabId:"rooms",search:"",zIndex:fa.getNextZIndex(),currentRooms:void 0}),ja=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).close=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.handleMainTabChange=function(e){return function(){var t=n.state.search;"search"===e?(n.setState({mainTabId:e,currentRooms:[]}),t.length>0&&qn.getGame().uiManager.doRequestNavigatorSearch(t)):(n.setState({mainTabId:e,currentRooms:void 0}),n.requestRoomList(e))}},n.handleSearchChange=function(e){n.setState({search:e.target.value})},n.handleSearch=function(e){var t=n.state.search;e.preventDefault(),n.setState({mainTabId:"search",currentRooms:void 0}),qn.getGame().uiManager.doRequestNavigatorSearch(t)},n.handleGoToRoom=function(e){return function(){qn.getGame().uiManager.doRequestGoToRoom(e)}},n.handleCreateRoom=function(){qn.getGame().uiManager.doOpenCreateRoom()},n.state=Ta,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame();t.uiManager.onOpenNavigator=function(){var t=e.state.mainTabId;e.requestRoomList(t),e.setState({visible:!0,zIndex:fa.getNextZIndex()})},t.uiManager.onCloseNavigator=function(){e.setState({visible:!1})},t.uiManager.onLoadRoomList=function(t){e.setState({currentRooms:t})}}},{key:"generateTabs",value:function(){var e=this.state.mainTabId;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.handleMainTabChange("rooms"),className:"rooms"===e?"selected":""},"Rooms"),r.a.createElement("button",{onClick:this.handleMainTabChange("me"),className:"me"===e?"selected":""},"Me"),r.a.createElement("button",{onClick:this.handleMainTabChange("search"),className:"search"===e?"selected":""},"Search"))}},{key:"requestRoomList",value:function(e){switch(e){case"me":qn.getGame().uiManager.doRequestNavigatorMyRooms();break;case"rooms":qn.getGame().uiManager.doRequestNavigatorRooms()}}},{key:"calculateUserCountColor",value:function(e,t){return 0===e?"":"g"}},{key:"generateGrid",value:function(){var e=this,t=this.state.currentRooms;return null==t?r.a.createElement("p",null,"Loading..."):t.sort((function(e,t){return t.userCount-e.userCount})).map((function(t){var n=r.a.createElement(r.a.Fragment,null);return t.lockType===de.Locked?n=r.a.createElement("button",{className:"door_bell"}):t.lockType===de.Password&&(n=r.a.createElement("button",{className:"door_password"})),r.a.createElement("div",{className:"room_button",key:t.id,onClick:e.handleGoToRoom(t.id)},r.a.createElement("span",null,t.name.substr(0,30)),r.a.createElement("div",{className:"icons_container"},n,r.a.createElement("button",{className:t.isFavourite?"favourite":"make_favourite"}),r.a.createElement("button",{className:"usercount "+e.calculateUserCountColor(t.userCount,t.capacity)},t.userCount)))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex,i=t.search;return n?r.a.createElement(Wn.a,{defaultClassName:"nav",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.close},"X"),r.a.createElement("h2",{className:"title"},"Navigator"),r.a.createElement("hr",null),r.a.createElement("div",{className:"main_tab_container"},this.generateTabs()),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"search_bar"},r.a.createElement("form",{onSubmit:this.handleSearch},r.a.createElement("input",{autoComplete:"off",type:"text",onChange:this.handleSearchChange,value:i,name:"room_search",placeholder:"Search a room..."}),r.a.createElement("button",null,"Search"))),r.a.createElement("div",{className:"basic_rooms"},this.generateGrid()),r.a.createElement("div",{className:"more_rooms"},r.a.createElement("div",{className:"info"},r.a.createElement("img",{src:"images/navigator/create_room.png",alt:"More rooms"}),r.a.createElement("span",null,"More rooms?")),r.a.createElement("button",{onClick:this.handleCreateRoom},"Create room"))))):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component),Na=(n(65),[{tileCount:104,id:"model_a"},{tileCount:94,id:"model_b"},{tileCount:36,id:"model_c"},{tileCount:84,id:"model_d"},{tileCount:80,id:"model_e"},{tileCount:80,id:"model_f"},{tileCount:416,id:"model_i"},{tileCount:320,id:"model_j"},{tileCount:448,id:"model_k"},{tileCount:352,id:"model_l"},{tileCount:384,id:"model_m"},{tileCount:372,id:"model_n"},{tileCount:80,id:"model_g"},{tileCount:74,id:"model_h"},{tileCount:416,id:"model_o"},{tileCount:352,id:"model_p"},{tileCount:304,id:"model_q"},{tileCount:336,id:"model_r"},{tileCount:748,id:"model_u"},{tileCount:438,id:"model_v"},{tileCount:540,id:"model_t"},{tileCount:512,id:"model_w"},{tileCount:396,id:"model_x"},{tileCount:440,id:"model_y"},{tileCount:456,id:"model_z"},{tileCount:208,id:"model_0"}]),Fa={zIndex:fa.getNextZIndex(),visible:!1,selectedModel:Na[0].id,name:""},Pa=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).close=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.handleSubmit=function(e){var t=n.state,a=t.name,i=t.selectedModel;e.preventDefault(),a.length>0&&qn.getGame().uiManager.doRequestCreateRoom(a,i)},n.handleNameChange=function(e){n.setState({name:e.target.value})},n.handleSelect=function(e){return function(){n.setState({selectedModel:e})}},n.state=Fa,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame();t.uiManager.onOpenCreateRoom=function(){e.setState({visible:!0,zIndex:fa.getNextZIndex()})},t.uiManager.onCloseCreateRoom=function(){e.setState({visible:!1})}}},{key:"generateGrid",value:function(){var e=this,t=this.state.selectedModel;return Na.map((function(n){return r.a.createElement("button",{key:n.id,onClick:e.handleSelect(n.id),className:t===n.id?"selected":""},r.a.createElement("img",{src:"images/navigator/"+n.id+".png",alt:n.id}),r.a.createElement("div",{className:"tile_count"},r.a.createElement("img",{src:"images/navigator/tile_icon_black.png",alt:n.tileCount+" tiles"}),r.a.createElement("span",null,n.tileCount," tiles")))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex,i=t.name;return n?r.a.createElement(Wn.a,{defaultClassName:"createroom",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.close},"X"),r.a.createElement("h2",{className:"title"},"Create a room"),r.a.createElement("hr",null),r.a.createElement("div",{className:"wrapper"},r.a.createElement("h2",null,"Choose style"),r.a.createElement("div",{className:"grid"},this.generateGrid()),r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("h2",null,"Room name"),r.a.createElement("input",{maxLength:33,onChange:this.handleNameChange,value:i,type:"text",placeholder:"Room name"}),r.a.createElement("div",{className:"button_container"},r.a.createElement("button",null,"Create room"),r.a.createElement("button",{onClick:this.close},"Cancel")))))):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component),Ga=n(10);n(66);!function(e){e[e.Friends=0]="Friends",e[e.Search=1]="Search",e[e.Requests=2]="Requests",e[e.None=3]="None"}(pa||(pa={}));var Aa={visible:!0,zIndex:fa.getNextZIndex(),search:"",currentTab:pa.Friends,firstRowActive:!0,secondRowActive:!0,currentSelectedFriendId:-1,onlineFriends:[],offlineFriends:[],friendsRequests:[],searchResult:[]},Ua=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).close=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.requestStartChat=function(e){return function(){qn.getGame().uiManager.doRequestStartChat(e)}},n.requestFollowFriend=function(e){return function(){qn.getGame().uiManager.doRequestFollowFriend(e)}},n.requestAddFriend=function(e){return function(){qn.getGame().uiManager.doRequestAskForFriend(e)}},n.requestRemoveFriend=function(e){return function(){-1!==e&&qn.getGame().uiManager.doRequestRemoveFriend(e)}},n.requestSearch=function(e){return function(){qn.getGame().uiManager.doRequestFriendSearch(e)}},n.requestAcceptFriendRequest=function(e){return function(){qn.getGame().uiManager.doRequestAcceptFriendRequest(e)}},n.requestDenyFriendRequest=function(e){return function(){qn.getGame().uiManager.doRequestDenyFriendRequest(e)}},n.requestAcceptAllFriendRequests=function(){n.state.friendsRequests.forEach((function(e){n.requestAcceptFriendRequest(e.id)()}))},n.requestDenyAllFriendRequests=function(){n.state.friendsRequests.forEach((function(e){n.requestDenyFriendRequest(e.id)()}))},n.toggleFirstRow=function(){var e=n.state.firstRowActive;n.setState({firstRowActive:!e})},n.toggleSecondRow=function(){var e=n.state.secondRowActive;n.setState({secondRowActive:!e})},n.handleChangeTab=function(e){return function(){n.setState({currentTab:e})}},n.handleSearchChange=function(e){n.setState({search:e.target.value})},n.handleSearch=function(e){e.preventDefault();var t=n.state.search;qn.getGame().uiManager.doRequestFriendSearch(t)},n.state=Aa,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=qn.getGame().uiManager;t.onOpenMessenger=function(){e.setState({visible:!0,zIndex:fa.getNextZIndex()})},t.onCloseMessenger=function(){e.setState({visible:!1})},t.onSetFriends=function(t,n){e.setState({onlineFriends:t,offlineFriends:n})},t.onSetFriendRequests=function(t){e.setState({friendsRequests:t})},t.onSetFriendsSearch=function(t){e.setState({searchResult:t})}}},{key:"generateRequestsGrid",value:function(e){var t=this;return e.map((function(e){return r.a.createElement("div",{key:e.id,className:"friend"},r.a.createElement("img",{src:"https://www.habbo.com/habbo-imaging/avatarimage?figure="+e.look+"&direction=2&head_direction=2&size=s&headonly=1",alt:e.name}),r.a.createElement("span",null,e.name),r.a.createElement("div",{className:"icons_container"},r.a.createElement("button",{onClick:t.requestAcceptFriendRequest(e.id),className:"accept"}),r.a.createElement("button",{onClick:t.requestDenyFriendRequest(e.id),className:"decline"})))}))}},{key:"generateOnlineFriendsGrid",value:function(e){var t=this;return e.map((function(e){return r.a.createElement("div",{key:e.id,className:"friend"},r.a.createElement("img",{src:"https://www.habbo.com/habbo-imaging/avatarimage?figure="+e.look+"&direction=2&head_direction=2&size=s&headonly=1",alt:e.name}),r.a.createElement("span",null,e.name),r.a.createElement("div",{className:"icons_container"},r.a.createElement("button",{onClick:t.requestStartChat(e.id),className:"start_chat"}),r.a.createElement("button",{onClick:t.requestFollowFriend(e.id),className:"follow_friend"})))}))}},{key:"generateOfflineFriendsGrid",value:function(e){return e.map((function(e){return r.a.createElement("div",{key:e.id,className:"friend"},r.a.createElement("img",{src:"https://www.habbo.com/habbo-imaging/avatarimage?figure="+e.look+"&direction=2&head_direction=2&size=s&headonly=1",alt:e.name}),r.a.createElement("span",null,e.name))}))}},{key:"generateSearchGrid",value:function(e){var t=this;return e.map((function(e){return r.a.createElement("div",{key:e.id,className:"friend"},r.a.createElement("img",{src:"https://www.habbo.com/habbo-imaging/avatarimage?figure="+e.look+"&direction=2&head_direction=2&size=s&headonly=1",alt:e.name}),r.a.createElement("span",null,e.name),r.a.createElement("div",{className:"icons_container"},r.a.createElement("button",{onClick:t.requestAddFriend(e.id),className:"ask_for_friend"})))}))}},{key:"generateFriendsTab",value:function(){var e=this.state,t=e.currentTab,n=e.firstRowActive,a=e.secondRowActive,i=e.onlineFriends,o=e.offlineFriends,s=e.currentSelectedFriendId;return t===pa.Friends?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{onClick:this.handleChangeTab(pa.None),className:"main_tab selected"},r.a.createElement("span",null,"Friends"),r.a.createElement("button",{className:"close_arrow"})),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"friends_container"},r.a.createElement("button",{onClick:this.toggleFirstRow,className:"second_tab"},"Friends (",i.length,")"),r.a.createElement("div",{className:"friend_list"},n?this.generateOnlineFriendsGrid(i):r.a.createElement(r.a.Fragment,null)),r.a.createElement("button",{onClick:this.toggleSecondRow,className:"second_tab"},"Offline friends (",o.length,")"),r.a.createElement("div",{className:"friend_list"},a?this.generateOfflineFriendsGrid(o):r.a.createElement(r.a.Fragment,null))),r.a.createElement("div",{className:"actions_container"},r.a.createElement("button",{onClick:this.requestRemoveFriend(s)},r.a.createElement("img",{src:"/images/messenger/remove_friend.png",alt:"Remove friend"})),r.a.createElement("button",{onClick:this.requestStartChat(s)},r.a.createElement("img",{src:"/images/messenger/open_inbox.png",alt:"Open inbox"}))))):r.a.createElement("div",{onClick:this.handleChangeTab(pa.Friends),className:"main_tab selected"},r.a.createElement("span",null,"Friends"),r.a.createElement("button",{className:"open_arrow"}))}},{key:"generateSearchTab",value:function(){var e=this.state,t=e.currentTab,n=e.search,a=e.firstRowActive,i=e.secondRowActive,o=e.onlineFriends,s=e.offlineFriends,l=e.searchResult,c=[].concat(Object(Ga.a)(o),Object(Ga.a)(s)).filter((function(e){return e.name.toLowerCase().includes(n.toLowerCase())}));return t===pa.Search?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{onClick:this.handleChangeTab(pa.None),className:"main_tab"},r.a.createElement("span",null,"Search"),r.a.createElement("button",{className:"close_arrow"})),r.a.createElement("div",{className:"wrapper search"},r.a.createElement("div",{className:"friends_container"},r.a.createElement("button",{onClick:this.toggleFirstRow,className:"second_tab"},"Friends (",c.length,")"),r.a.createElement("div",{className:"friend_list"},a?this.generateOfflineFriendsGrid(c):r.a.createElement(r.a.Fragment,null)),r.a.createElement("button",{onClick:this.toggleSecondRow,className:"second_tab"},"Other users (",l.length,")"),r.a.createElement("div",{className:"friend_list"},i?this.generateSearchGrid(l):r.a.createElement(r.a.Fragment,null))),r.a.createElement("div",{className:"actions_container"},r.a.createElement("form",{onSubmit:this.handleSearch},r.a.createElement("input",{autoComplete:"off",type:"text",onChange:this.handleSearchChange,value:n,name:"room_search",placeholder:"Search..."}),r.a.createElement("button",null,"Search"))))):r.a.createElement("div",{onClick:this.handleChangeTab(pa.Search),className:"main_tab"},r.a.createElement("span",null,"Search"),r.a.createElement("button",{className:"open_arrow"}))}},{key:"generateRequestsTab",value:function(){var e=this.state,t=e.currentTab,n=e.friendsRequests,a="main_tab "+(n.length>0?"active":"");return t===pa.Requests?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{onClick:this.handleChangeTab(pa.None),className:a},r.a.createElement("span",null,"Friend requests"),r.a.createElement("button",{className:"close_arrow"})),r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"friends_container"},r.a.createElement("div",{className:"friend_list"},this.generateRequestsGrid(n))),r.a.createElement("div",{className:"actions_container requests"},r.a.createElement("button",{onClick:this.requestAcceptAllFriendRequests},r.a.createElement("img",{src:"/images/messenger/accept.png",alt:"Remove friend"}),r.a.createElement("span",null,"Accept all")),r.a.createElement("button",{onClick:this.requestDenyAllFriendRequests},r.a.createElement("img",{src:"/images/messenger/decline.png",alt:"Remove friend"}),r.a.createElement("span",null,"Deny all"))))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{onClick:this.handleChangeTab(pa.Requests),className:a},r.a.createElement("span",null,"Friend requests"),r.a.createElement("button",{className:"open_arrow"})))}},{key:"generateFooter",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"footer"},r.a.createElement("button",null,r.a.createElement("img",{src:"/images/messenger/open_edit_ctgs.png",alt:"Settings"}),r.a.createElement("span",null,"Settings"))))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex;return n?r.a.createElement(Wn.a,{defaultClassName:"messenger",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.close},"X"),r.a.createElement("h2",{className:"title"},"Friends"),this.generateFriendsTab(),this.generateSearchTab(),this.generateRequestsTab(),this.generateFooter())):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component),qa=(n(67),{visible:!1,zIndex:fa.getNextZIndex(),text:"",messages:[],currentActiveChatId:0,currentTabOffset:0,activeChats:[],notifications:[]}),La=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).chatWrapper=void 0,n.close=function(){n.setState({visible:!1})},n.upgradeZIndex=function(){n.setState({zIndex:fa.getNextZIndex()})},n.handleKeyDown=function(e){var t=e,a=13===t.which,i=n.state,r=i.currentActiveChatId,o=i.text;a&&(t.preventDefault(),o.length>0&&qn.getGame().uiManager.doRequestSendChatMessage(r,o),n.setState({text:""}))},n.handleChange=function(e){n.setState({text:e.target.value})},n.requestFollowFriend=function(){var e=n.state.currentActiveChatId;qn.getGame().uiManager.doRequestFollowFriend(e)},n.requestCloseChat=function(){var e=n.state,t=e.activeChats,a=e.currentActiveChatId,i=t.filter((function(e){return e.id!==a}));0===i.length?n.setState({activeChats:i,currentActiveChatId:0,visible:!1}):(n.setState({activeChats:i}),qn.getGame().uiManager.doRequestStartChat(i[0].id))},n.handleTabChange=function(e){return function(){var t=n.state.notifications;t.includes(e)&&n.setState({notifications:t.filter((function(t){return t!==e}))}),qn.getGame().uiManager.doRequestStartChat(e)}},n.handleOffsetChange=function(e){return function(){var t=n.state.currentTabOffset;n.setState({currentTabOffset:t+e})}},n.state=qa,n.chatWrapper=r.a.createRef(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"scrollDown",value:function(){null!=this.chatWrapper.current&&(window.wrapper=this.chatWrapper.current,this.chatWrapper.current.scrollTop=this.chatWrapper.current.scrollHeight-this.chatWrapper.current.clientHeight)}},{key:"componentDidMount",value:function(){var e=this,t=qn.getGame().uiManager;t.onOpenChat=function(){var t=e.state.activeChats;e.setState({visible:t.length>0,zIndex:fa.getNextZIndex()})},t.onCloseChat=function(){e.setState({visible:!1})},t.onOpenMessengerChat=function(t){var n=e.state.activeChats;n.find((function(e){return e.id===t.user.id}))?e.setState({visible:!0,zIndex:fa.getNextZIndex(),messages:t.chats,currentActiveChatId:t.user.id}):e.setState({visible:!0,zIndex:fa.getNextZIndex(),activeChats:[].concat(Object(Ga.a)(n),[t.user]),messages:t.chats,currentActiveChatId:t.user.id}),e.scrollDown()},t.onReceiveMessengerMessage=function(t){var n=e.state,a=n.currentActiveChatId,i=n.notifications,r=n.activeChats,o=n.visible;if(r.find((function(e){return e.id===t.user.id}))){if(a===t.user.id)return e.setState({messages:t.chats}),e.scrollDown(),o;e.setState({notifications:[].concat(Object(Ga.a)(i),[t.user.id])})}else 0===r.length?(e.setState({activeChats:[].concat(Object(Ga.a)(r),[t.user]),messages:t.chats,currentActiveChatId:t.user.id}),e.scrollDown()):e.setState({activeChats:[].concat(Object(Ga.a)(r),[t.user]),notifications:[].concat(Object(Ga.a)(i),[t.user.id])});return!1}}},{key:"generateFriendTab",value:function(e){var t=this.state,n=t.currentActiveChatId,a=t.notifications,i=e.id===n?"selected":"";return a.includes(e.id)&&(i="alert"),r.a.createElement("button",{onClick:this.handleTabChange(e.id),key:e.id,className:i},r.a.createElement("img",{src:"https://www.habbo.com/habbo-imaging/avatarimage?figure="+e.look+"&direction=2&head_direction=2&size=s&headonly=1",alt:e.name}))}},{key:"generateLeftArrow",value:function(){var e=this.state.currentTabOffset;return 0!==e?r.a.createElement("button",{onClick:this.handleOffsetChange(2===e?-2:-1),className:"arrow"},r.a.createElement("img",{src:"/images/messenger/prev.png",alt:""})):r.a.createElement(r.a.Fragment,null)}},{key:"generateRightArrow",value:function(){var e=this.state,t=e.activeChats,n=e.currentTabOffset;return t.length-n!==6?r.a.createElement("button",{onClick:this.handleOffsetChange(0===n?2:1),className:"arrow"},r.a.createElement("img",{src:"/images/messenger/next.png",alt:""})):r.a.createElement(r.a.Fragment,null)}},{key:"generateMainTabs",value:function(){var e=this,t=this.state,n=t.activeChats,a=t.currentTabOffset;if(n.length>7){var i=[],o=7;0===a&&o--,n.length-a===6?o--:a>0&&(o-=2);for(var s=0;s<o;s++)i.push(this.generateFriendTab(n[s+Math.max(0,a)]));return r.a.createElement(r.a.Fragment,null,this.generateLeftArrow(),i,this.generateRightArrow())}return n.map((function(t){return e.generateFriendTab(t)}))}},{key:"generateChats",value:function(){var e=this.state.messages,t=0;return e.map((function(e){var n="";return e.type===Ut.Me&&(n="me"),e.type===Ut.Info&&(n="info"),r.a.createElement("p",{key:t++,className:n},e.text)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.visible,a=t.zIndex,i=t.text,o=t.activeChats,s=t.currentActiveChatId;if(!n||0===o.length)return r.a.createElement(r.a.Fragment,null);var l="Chat",c=o.find((function(e){return e.id===s}));return void 0!==c&&(l=c.name),r.a.createElement(Wn.a,{defaultClassName:"chat",handle:".title",onStart:function(){return e.upgradeZIndex()},onMouseDown:function(){return e.upgradeZIndex()}},r.a.createElement("div",{style:{zIndex:a}},r.a.createElement("button",{className:"close",onClick:this.close},"X"),r.a.createElement("h2",{className:"title"},l),r.a.createElement("div",{className:"main_tab_container"},this.generateMainTabs()),r.a.createElement("div",{className:"actions_container"},r.a.createElement("button",{onClick:this.requestFollowFriend},r.a.createElement("img",{src:"/images/messenger/follow_friend.png",alt:"Follow friend"})),r.a.createElement("button",{onClick:this.requestCloseChat,className:"close_chat"},r.a.createElement("img",{src:"/images/messenger/close.png",alt:"Close"}))),r.a.createElement("div",{className:"wrapper",ref:this.chatWrapper},this.generateChats()),r.a.createElement("form",null,r.a.createElement("textarea",{value:i,onKeyDown:this.handleKeyDown,onChange:this.handleChange,rows:2,cols:10}))))}}]),t}(r.a.Component),Da={gameLoaded:!1,loggedIn:!1,error:"",loadingInfo:"",userData:{id:-1,name:"",motto:"",look:""},initialized:!1},za=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateChatFocuser=function(e){qn.getGame().uiManager.onFocusChat=e},n.state=Da,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;try{var t=qn.getGame();t.uiManager.onLoadPost=function(t){e.setState({loadingInfo:t})},t.loadGame().then((function(){e.setState({gameLoaded:!0}),t.uiManager.onGameStop=function(){e.setState({error:"Game has stoppped!"})}})).catch((function(t){var n=t;t instanceof Error&&(n=t.message),e.setState({gameLoaded:!1,loggedIn:!1,error:n})})),t.uiManager.onSetUserData=function(n){t.avatarImager.generateGeneric(new De(n.look,2,2,["std"],"std",0,!0,!1,"n"),!1).then((function(t){e.setState({loggedIn:!0,userData:{id:n.id,name:n.name,look:n.look,motto:n.motto,image:ra(t)}})}))},this.setState({initialized:!0}),window.mainGame=t}catch(a){var n=a;a instanceof Error&&a.message.includes("WebGL unsupported")&&(n="Please enable hardware acceleration."),this.setState({error:n})}}},{key:"render",value:function(){var e=this.state,t=e.gameLoaded,n=e.error,a=e.loggedIn,i=e.loadingInfo,o=e.userData,s=e.initialized,l=r.a.createElement(r.a.Fragment,null);return""!==n?l=r.a.createElement(va,{errorText:n}):t?a||(l=r.a.createElement(la,null)):l=r.a.createElement(ia,{loadingText:i}),s?r.a.createElement(r.a.Fragment,null,r.a.createElement(Jn,null),r.a.createElement(Xn,null),l,r.a.createElement(Ia,null),r.a.createElement(_a,null),r.a.createElement(xa,null),r.a.createElement(ja,null),r.a.createElement(Pa,null),r.a.createElement(Ua,null),r.a.createElement(La,null),r.a.createElement(Ra,null),r.a.createElement(Yn,null),r.a.createElement(ga,null),r.a.createElement(Hn,{focuser:this.updateChatFocuser,headImage:o.image})):l}}]),t}(i.Component),Ha=document.getElementById("root");null!=Ha&&Ha.hasChildNodes()?Object(o.hydrate)(r.a.createElement(za,null),Ha):Object(o.render)(r.a.createElement(za,null),Ha)}},[[28,1,2]]]);
//# sourceMappingURL=main.d9fb6ed0.chunk.js.map